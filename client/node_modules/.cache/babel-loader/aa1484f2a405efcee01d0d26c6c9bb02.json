{"ast":null,"code":"import axios from 'axios';\nimport { dialogBox } from '../../alerts/alertsFuns';\nexport const alertUnsavedChanges = async (initilState, state, setUpdates, history) => {\n  if (JSON.stringify(state) !== JSON.stringify(initilState)) {\n    // const unblockRouting = history.block();\n    // const targetPathname = history.location.pathname;\n    // //submenu link clicked\n    // const targetTab = history.location.search;\n    // const currentPathname = window.location.pathname;\n    // console.log('target', targetPathname, targetTab);\n    // console.log('current', currentPathname);\n    // history.push(currentPathname + '?tab=update');\n    const targetPathname = history.location.pathname;\n    const currentPathname = window.location.pathname;\n    history.push('/dashboard/profile');\n    const unblockRouting = history.block();\n    console.log(targetPathname, currentPathname);\n    const msg = `You have some unsaved changes. What would you like to do?`;\n    const cancelBtnText = 'Discharge changes';\n    const confirmBtnText = 'Return to the form!';\n\n    const confirmCb = () => {\n      unblockRouting();\n    };\n\n    const cancelCb = async () => {\n      //discharge all changes and clear app changes status\n      // chnages clear on reload\n      if (targetPathname === currentPathname) {\n        //on clicking submenu redirect to the targeted tab\n        window.location.replace(window.location.origin + targetPathname + targetTab);\n      } else {\n        window.location.replace(window.location.origin + targetPathname);\n      }\n    };\n\n    dialogBox({\n      msg,\n      cancelBtnText,\n      confirmBtnText,\n      confirmCb,\n      cancelCb\n    });\n  } else {\n    //no chnages\n    setUpdates(null);\n  }\n};\nexport const saveChangesOnLeave = async (initilState, state, endSession, http //api call\n) => {\n  try {\n    if (JSON.stringify(state) !== JSON.stringify(initilState)) {\n      const config = {\n        headers: {\n          'Content-Type': 'application/json'\n        }\n      };\n      await axios.post(http, JSON.stringify(state), config); // await getState();\n    }\n  } catch (err) {\n    if (err.response.data.msg === 'AuthError') {\n      endSession('Your session has expired. Please sign back in.');\n    }\n  }\n};","map":{"version":3,"sources":["/Users/krispol/Desktop/invoice/invoice-with-session/client/src/components/form/utils/handleUnsavedChanges.js"],"names":["axios","dialogBox","alertUnsavedChanges","initilState","state","setUpdates","history","JSON","stringify","targetPathname","location","pathname","currentPathname","window","push","unblockRouting","block","console","log","msg","cancelBtnText","confirmBtnText","confirmCb","cancelCb","replace","origin","targetTab","saveChangesOnLeave","endSession","http","config","headers","post","err","response","data"],"mappings":"AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,SAASC,SAAT,QAA0B,yBAA1B;AAEA,OAAO,MAAMC,mBAAmB,GAAG,OAC/BC,WAD+B,EAE/BC,KAF+B,EAG/BC,UAH+B,EAI/BC,OAJ+B,KAK9B;AACD,MAAIC,IAAI,CAACC,SAAL,CAAeJ,KAAf,MAA0BG,IAAI,CAACC,SAAL,CAAeL,WAAf,CAA9B,EAA2D;AACvD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA,UAAMM,cAAc,GAAGH,OAAO,CAACI,QAAR,CAAiBC,QAAxC;AACA,UAAMC,eAAe,GAAGC,MAAM,CAACH,QAAP,CAAgBC,QAAxC;AACAL,IAAAA,OAAO,CAACQ,IAAR,CAAa,oBAAb;AACA,UAAMC,cAAc,GAAGT,OAAO,CAACU,KAAR,EAAvB;AAEAC,IAAAA,OAAO,CAACC,GAAR,CAAYT,cAAZ,EAA4BG,eAA5B;AAEA,UAAMO,GAAG,GAAI,2DAAb;AACA,UAAMC,aAAa,GAAG,mBAAtB;AACA,UAAMC,cAAc,GAAG,qBAAvB;;AACA,UAAMC,SAAS,GAAG,MAAM;AACpBP,MAAAA,cAAc;AACjB,KAFD;;AAGA,UAAMQ,QAAQ,GAAG,YAAY;AACzB;AACA;AACA,UAAId,cAAc,KAAKG,eAAvB,EAAwC;AACpC;AACAC,QAAAA,MAAM,CAACH,QAAP,CAAgBc,OAAhB,CACIX,MAAM,CAACH,QAAP,CAAgBe,MAAhB,GAAyBhB,cAAzB,GAA0CiB,SAD9C;AAGH,OALD,MAKO;AACHb,QAAAA,MAAM,CAACH,QAAP,CAAgBc,OAAhB,CACIX,MAAM,CAACH,QAAP,CAAgBe,MAAhB,GAAyBhB,cAD7B;AAGH;AACJ,KAbD;;AAeAR,IAAAA,SAAS,CAAC;AACNkB,MAAAA,GADM;AAENC,MAAAA,aAFM;AAGNC,MAAAA,cAHM;AAINC,MAAAA,SAJM;AAKNC,MAAAA;AALM,KAAD,CAAT;AAOH,GA7CD,MA6CO;AACH;AACAlB,IAAAA,UAAU,CAAC,IAAD,CAAV;AACH;AACJ,CAvDM;AAyDP,OAAO,MAAMsB,kBAAkB,GAAG,OAC9BxB,WAD8B,EAE9BC,KAF8B,EAG9BwB,UAH8B,EAI9BC,IAJ8B,CAIzB;AAJyB,KAK7B;AACD,MAAI;AACA,QAAItB,IAAI,CAACC,SAAL,CAAeJ,KAAf,MAA0BG,IAAI,CAACC,SAAL,CAAeL,WAAf,CAA9B,EAA2D;AACvD,YAAM2B,MAAM,GAAG;AACXC,QAAAA,OAAO,EAAE;AACL,0BAAgB;AADX;AADE,OAAf;AAKA,YAAM/B,KAAK,CAACgC,IAAN,CAAWH,IAAX,EAAiBtB,IAAI,CAACC,SAAL,CAAeJ,KAAf,CAAjB,EAAwC0B,MAAxC,CAAN,CANuD,CAOvD;AACH;AACJ,GAVD,CAUE,OAAOG,GAAP,EAAY;AACV,QAAIA,GAAG,CAACC,QAAJ,CAAaC,IAAb,CAAkBhB,GAAlB,KAA0B,WAA9B,EAA2C;AACvCS,MAAAA,UAAU,CAAC,gDAAD,CAAV;AACH;AACJ;AACJ,CArBM","sourcesContent":["import axios from 'axios';\nimport { dialogBox } from '../../alerts/alertsFuns';\n\nexport const alertUnsavedChanges = async (\n    initilState,\n    state,\n    setUpdates,\n    history\n) => {\n    if (JSON.stringify(state) !== JSON.stringify(initilState)) {\n        // const unblockRouting = history.block();\n        // const targetPathname = history.location.pathname;\n        // //submenu link clicked\n        // const targetTab = history.location.search;\n        // const currentPathname = window.location.pathname;\n        // console.log('target', targetPathname, targetTab);\n        // console.log('current', currentPathname);\n        // history.push(currentPathname + '?tab=update');\n\n        const targetPathname = history.location.pathname;\n        const currentPathname = window.location.pathname;\n        history.push('/dashboard/profile');\n        const unblockRouting = history.block();\n\n        console.log(targetPathname, currentPathname);\n\n        const msg = `You have some unsaved changes. What would you like to do?`;\n        const cancelBtnText = 'Discharge changes';\n        const confirmBtnText = 'Return to the form!';\n        const confirmCb = () => {\n            unblockRouting();\n        };\n        const cancelCb = async () => {\n            //discharge all changes and clear app changes status\n            // chnages clear on reload\n            if (targetPathname === currentPathname) {\n                //on clicking submenu redirect to the targeted tab\n                window.location.replace(\n                    window.location.origin + targetPathname + targetTab\n                );\n            } else {\n                window.location.replace(\n                    window.location.origin + targetPathname\n                );\n            }\n        };\n\n        dialogBox({\n            msg,\n            cancelBtnText,\n            confirmBtnText,\n            confirmCb,\n            cancelCb,\n        });\n    } else {\n        //no chnages\n        setUpdates(null);\n    }\n};\n\nexport const saveChangesOnLeave = async (\n    initilState,\n    state,\n    endSession,\n    http //api call\n) => {\n    try {\n        if (JSON.stringify(state) !== JSON.stringify(initilState)) {\n            const config = {\n                headers: {\n                    'Content-Type': 'application/json',\n                },\n            };\n            await axios.post(http, JSON.stringify(state), config);\n            // await getState();\n        }\n    } catch (err) {\n        if (err.response.data.msg === 'AuthError') {\n            endSession('Your session has expired. Please sign back in.');\n        }\n    }\n};\n"]},"metadata":{},"sourceType":"module"}