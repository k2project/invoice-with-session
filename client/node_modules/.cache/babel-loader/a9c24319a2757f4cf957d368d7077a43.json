{"ast":null,"code":"\"use strict\";\n\nconst conversions = require(\"webidl-conversions\");\n\nconst idlUtils = require(\"../generated/utils.js\");\n\nconst ValidityState = require(\"../generated/ValidityState\");\n\nconst DefaultConstraintValidationImpl = require(\"../constraint-validation/DefaultConstraintValidation-impl\").implementation;\n\nconst {\n  mixin\n} = require(\"../../utils\");\n\nconst HTMLElementImpl = require(\"./HTMLElement-impl\").implementation;\n\nconst NODE_TYPE = require(\"../node-type\");\n\nconst HTMLCollection = require(\"../generated/HTMLCollection\");\n\nconst HTMLOptionsCollection = require(\"../generated/HTMLOptionsCollection\");\n\nconst {\n  domSymbolTree\n} = require(\"../helpers/internal-constants\");\n\nconst {\n  closest\n} = require(\"../helpers/traversal\");\n\nconst {\n  getLabelsForLabelable\n} = require(\"../helpers/form-controls\");\n\nclass HTMLSelectElementImpl extends HTMLElementImpl {\n  constructor(args, privateData) {\n    super(args, privateData);\n    this._options = HTMLOptionsCollection.createImpl([], {\n      element: this,\n      query: () => {\n        // Customized domSymbolTree.treeToArray() clone.\n        const array = [];\n\n        for (const child of domSymbolTree.childrenIterator(this)) {\n          if (child._localName === \"option\") {\n            array.push(child);\n          } else if (child._localName === \"optgroup\") {\n            for (const childOfGroup of domSymbolTree.childrenIterator(child)) {\n              if (childOfGroup._localName === \"option\") {\n                array.push(childOfGroup);\n              }\n            }\n          }\n        }\n\n        return array;\n      }\n    });\n    this._selectedOptions = null; // lazy\n\n    this._customValidityErrorMessage = \"\";\n    this._labels = null;\n  }\n\n  _formReset() {\n    for (const option of this.options) {\n      option._selectedness = option.hasAttribute(\"selected\");\n      option._dirtyness = false;\n    }\n\n    this._askedForAReset();\n  }\n\n  _askedForAReset() {\n    if (this.hasAttribute(\"multiple\")) {\n      return;\n    }\n\n    const selected = this.options.filter(opt => opt._selectedness);\n    const size = this._displaySize;\n\n    if (size === 1 && !selected.length) {\n      // select the first option that is not disabled\n      for (const option of this.options) {\n        let disabled = option.hasAttribute(\"disabled\");\n        const parentNode = domSymbolTree.parent(option);\n\n        if (parentNode && parentNode.nodeName.toUpperCase() === \"OPTGROUP\" && parentNode.hasAttribute(\"disabled\")) {\n          disabled = true;\n        }\n\n        if (!disabled) {\n          // (do not set dirty)\n          option._selectedness = true;\n          break;\n        }\n      }\n    } else if (selected.length >= 2) {\n      // select the last selected option\n      selected.forEach((option, index) => {\n        option._selectedness = index === selected.length - 1;\n      });\n    }\n  }\n\n  _descendantAdded(parent, child) {\n    if (child.nodeType === NODE_TYPE.ELEMENT_NODE) {\n      this._askedForAReset();\n    }\n\n    super._descendantAdded.apply(this, arguments);\n  }\n\n  _descendantRemoved(parent, child) {\n    if (child.nodeType === NODE_TYPE.ELEMENT_NODE) {\n      this._askedForAReset();\n    }\n\n    super._descendantRemoved.apply(this, arguments);\n  }\n\n  _attrModified(name) {\n    if (name === \"multiple\" || name === \"size\") {\n      this._askedForAReset();\n    }\n\n    super._attrModified.apply(this, arguments);\n  }\n\n  get _displaySize() {\n    if (this.hasAttribute(\"size\")) {\n      const attr = this.getAttribute(\"size\"); // We don't allow hexadecimal numbers here.\n      // eslint-disable-next-line radix\n\n      const size = parseInt(attr, 10);\n\n      if (!isNaN(size) && size >= 0) {\n        return size;\n      }\n    }\n\n    return this.hasAttribute(\"multiple\") ? 4 : 1;\n  }\n\n  get options() {\n    return this._options;\n  }\n\n  get selectedOptions() {\n    return HTMLCollection.createImpl([], {\n      element: this,\n      query: () => domSymbolTree.treeToArray(this, {\n        filter: node => node._localName === \"option\" && node._selectedness === true\n      })\n    });\n  }\n\n  get selectedIndex() {\n    for (let i = 0; i < this.options.length; i++) {\n      if (this.options.item(i)._selectedness) {\n        return i;\n      }\n    }\n\n    return -1;\n  }\n\n  set selectedIndex(index) {\n    for (let i = 0; i < this.options.length; i++) {\n      this.options.item(i).selected = i === index;\n    }\n  }\n\n  get labels() {\n    return getLabelsForLabelable(this);\n  }\n\n  get value() {\n    let i = this.selectedIndex;\n\n    if (this.options.length && i === -1) {\n      i = 0;\n    }\n\n    if (i === -1) {\n      return \"\";\n    }\n\n    return this.options.item(i).value;\n  }\n\n  set value(val) {\n    for (const option of this.options) {\n      if (option.value === val) {\n        option._selectedness = true;\n        option._dirtyness = true;\n      } else {\n        option._selectedness = false;\n      }\n    }\n  }\n\n  get form() {\n    return closest(this, \"form\");\n  }\n\n  get type() {\n    return this.hasAttribute(\"multiple\") ? \"select-multiple\" : \"select-one\";\n  }\n\n  get [idlUtils.supportedPropertyIndices]() {\n    return this.options[idlUtils.supportedPropertyIndices];\n  }\n\n  get length() {\n    return this.options.length;\n  }\n\n  set length(value) {\n    this.options.length = value;\n  }\n\n  item(index) {\n    return this.options.item(index);\n  }\n\n  namedItem(name) {\n    return this.options.namedItem(name);\n  }\n\n  [idlUtils.indexedSetNew](index, value) {\n    return this.options[idlUtils.indexedSetNew](index, value);\n  }\n\n  [idlUtils.indexedSetExisting](index, value) {\n    return this.options[idlUtils.indexedSetExisting](index, value);\n  }\n\n  add(opt, before) {\n    this.options.add(opt, before);\n  }\n\n  remove(index) {\n    if (arguments.length > 0) {\n      index = conversions.long(index, {\n        context: \"Failed to execute 'remove' on 'HTMLSelectElement': parameter 1\"\n      });\n      this.options.remove(index);\n    } else {\n      super.remove();\n    }\n  }\n\n  _barredFromConstraintValidationSpecialization() {\n    return this.hasAttribute(\"readonly\");\n  } // Constraint validation: If the element has its required attribute specified,\n  // and either none of the option elements in the select element's list of options\n  // have their selectedness set to true, or the only option element in the select\n  // element's list of options with its selectedness set to true is the placeholder\n  // label option, then the element is suffering from being missing.\n\n\n  get validity() {\n    if (!this._validity) {\n      this._validity = ValidityState.createImpl(this, {\n        valueMissing: () => {\n          if (!this.hasAttribute(\"required\")) {\n            return false;\n          }\n\n          const selectedOptionIndex = this.selectedIndex;\n          return selectedOptionIndex < 0 || selectedOptionIndex === 0 && this._hasPlaceholderOption;\n        }\n      });\n    }\n\n    return this._validity;\n  } // If a select element has a required attribute specified, does not have a multiple attribute\n  // specified, and has a display size of 1; and if the value of the first option element in the\n  // select element's list of options (if any) is the empty string, and that option element's parent\n  // node is the select element(and not an optgroup element), then that option is the select\n  // element's placeholder label option.\n  // https://html.spec.whatwg.org/multipage/form-elements.html#placeholder-label-option\n\n\n  get _hasPlaceholderOption() {\n    return this.hasAttribute(\"required\") && !this.hasAttribute(\"multiple\") && this._displaySize === 1 && this.options.length > 0 && this.options.item(0).value === \"\" && this.options.item(0).parentNode._localName !== \"optgroup\";\n  }\n\n}\n\nmixin(HTMLSelectElementImpl.prototype, DefaultConstraintValidationImpl.prototype);\nmodule.exports = {\n  implementation: HTMLSelectElementImpl\n};","map":{"version":3,"sources":["/Users/krispol/Desktop/invoice/invoice-with-session/client/node_modules/jsdom/lib/jsdom/living/nodes/HTMLSelectElement-impl.js"],"names":["conversions","require","idlUtils","ValidityState","DefaultConstraintValidationImpl","implementation","mixin","HTMLElementImpl","NODE_TYPE","HTMLCollection","HTMLOptionsCollection","domSymbolTree","closest","getLabelsForLabelable","HTMLSelectElementImpl","constructor","args","privateData","_options","createImpl","element","query","array","child","childrenIterator","_localName","push","childOfGroup","_selectedOptions","_customValidityErrorMessage","_labels","_formReset","option","options","_selectedness","hasAttribute","_dirtyness","_askedForAReset","selected","filter","opt","size","_displaySize","length","disabled","parentNode","parent","nodeName","toUpperCase","forEach","index","_descendantAdded","nodeType","ELEMENT_NODE","apply","arguments","_descendantRemoved","_attrModified","name","attr","getAttribute","parseInt","isNaN","selectedOptions","treeToArray","node","selectedIndex","i","item","labels","value","val","form","type","supportedPropertyIndices","namedItem","indexedSetNew","indexedSetExisting","add","before","remove","long","context","_barredFromConstraintValidationSpecialization","validity","_validity","valueMissing","selectedOptionIndex","_hasPlaceholderOption","prototype","module","exports"],"mappings":"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","sourcesContent":["\"use strict\";\n\nconst conversions = require(\"webidl-conversions\");\n\nconst idlUtils = require(\"../generated/utils.js\");\nconst ValidityState = require(\"../generated/ValidityState\");\nconst DefaultConstraintValidationImpl =\n  require(\"../constraint-validation/DefaultConstraintValidation-impl\").implementation;\nconst { mixin } = require(\"../../utils\");\nconst HTMLElementImpl = require(\"./HTMLElement-impl\").implementation;\nconst NODE_TYPE = require(\"../node-type\");\nconst HTMLCollection = require(\"../generated/HTMLCollection\");\nconst HTMLOptionsCollection = require(\"../generated/HTMLOptionsCollection\");\nconst { domSymbolTree } = require(\"../helpers/internal-constants\");\nconst { closest } = require(\"../helpers/traversal\");\nconst { getLabelsForLabelable } = require(\"../helpers/form-controls\");\n\nclass HTMLSelectElementImpl extends HTMLElementImpl {\n  constructor(args, privateData) {\n    super(args, privateData);\n    this._options = HTMLOptionsCollection.createImpl([], {\n      element: this,\n      query: () => {\n        // Customized domSymbolTree.treeToArray() clone.\n        const array = [];\n        for (const child of domSymbolTree.childrenIterator(this)) {\n          if (child._localName === \"option\") {\n            array.push(child);\n          } else if (child._localName === \"optgroup\") {\n            for (const childOfGroup of domSymbolTree.childrenIterator(child)) {\n              if (childOfGroup._localName === \"option\") {\n                array.push(childOfGroup);\n              }\n            }\n          }\n        }\n        return array;\n      }\n    });\n    this._selectedOptions = null; // lazy\n\n    this._customValidityErrorMessage = \"\";\n\n    this._labels = null;\n  }\n\n  _formReset() {\n    for (const option of this.options) {\n      option._selectedness = option.hasAttribute(\"selected\");\n      option._dirtyness = false;\n    }\n    this._askedForAReset();\n  }\n\n  _askedForAReset() {\n    if (this.hasAttribute(\"multiple\")) {\n      return;\n    }\n\n    const selected = this.options.filter(opt => opt._selectedness);\n\n    const size = this._displaySize;\n    if (size === 1 && !selected.length) {\n      // select the first option that is not disabled\n      for (const option of this.options) {\n        let disabled = option.hasAttribute(\"disabled\");\n        const parentNode = domSymbolTree.parent(option);\n        if (parentNode &&\n          parentNode.nodeName.toUpperCase() === \"OPTGROUP\" &&\n          parentNode.hasAttribute(\"disabled\")) {\n          disabled = true;\n        }\n\n        if (!disabled) {\n          // (do not set dirty)\n          option._selectedness = true;\n          break;\n        }\n      }\n    } else if (selected.length >= 2) {\n      // select the last selected option\n      selected.forEach((option, index) => {\n        option._selectedness = index === selected.length - 1;\n      });\n    }\n  }\n\n  _descendantAdded(parent, child) {\n    if (child.nodeType === NODE_TYPE.ELEMENT_NODE) {\n      this._askedForAReset();\n    }\n\n    super._descendantAdded.apply(this, arguments);\n  }\n\n  _descendantRemoved(parent, child) {\n    if (child.nodeType === NODE_TYPE.ELEMENT_NODE) {\n      this._askedForAReset();\n    }\n\n    super._descendantRemoved.apply(this, arguments);\n  }\n\n  _attrModified(name) {\n    if (name === \"multiple\" || name === \"size\") {\n      this._askedForAReset();\n    }\n    super._attrModified.apply(this, arguments);\n  }\n\n  get _displaySize() {\n    if (this.hasAttribute(\"size\")) {\n      const attr = this.getAttribute(\"size\");\n      // We don't allow hexadecimal numbers here.\n      // eslint-disable-next-line radix\n      const size = parseInt(attr, 10);\n      if (!isNaN(size) && size >= 0) {\n        return size;\n      }\n    }\n    return this.hasAttribute(\"multiple\") ? 4 : 1;\n  }\n\n  get options() {\n    return this._options;\n  }\n\n  get selectedOptions() {\n    return HTMLCollection.createImpl([], {\n      element: this,\n      query: () => domSymbolTree.treeToArray(this, {\n        filter: node => node._localName === \"option\" && node._selectedness === true\n      })\n    });\n  }\n\n  get selectedIndex() {\n    for (let i = 0; i < this.options.length; i++) {\n      if (this.options.item(i)._selectedness) {\n        return i;\n      }\n    }\n    return -1;\n  }\n\n  set selectedIndex(index) {\n    for (let i = 0; i < this.options.length; i++) {\n      this.options.item(i).selected = i === index;\n    }\n  }\n\n  get labels() {\n    return getLabelsForLabelable(this);\n  }\n\n  get value() {\n    let i = this.selectedIndex;\n    if (this.options.length && (i === -1)) {\n      i = 0;\n    }\n    if (i === -1) {\n      return \"\";\n    }\n    return this.options.item(i).value;\n  }\n\n  set value(val) {\n    for (const option of this.options) {\n      if (option.value === val) {\n        option._selectedness = true;\n        option._dirtyness = true;\n      } else {\n        option._selectedness = false;\n      }\n    }\n  }\n\n  get form() {\n    return closest(this, \"form\");\n  }\n\n  get type() {\n    return this.hasAttribute(\"multiple\") ? \"select-multiple\" : \"select-one\";\n  }\n\n  get [idlUtils.supportedPropertyIndices]() {\n    return this.options[idlUtils.supportedPropertyIndices];\n  }\n\n  get length() {\n    return this.options.length;\n  }\n\n  set length(value) {\n    this.options.length = value;\n  }\n\n  item(index) {\n    return this.options.item(index);\n  }\n\n  namedItem(name) {\n    return this.options.namedItem(name);\n  }\n\n  [idlUtils.indexedSetNew](index, value) {\n    return this.options[idlUtils.indexedSetNew](index, value);\n  }\n\n  [idlUtils.indexedSetExisting](index, value) {\n    return this.options[idlUtils.indexedSetExisting](index, value);\n  }\n\n  add(opt, before) {\n    this.options.add(opt, before);\n  }\n\n  remove(index) {\n    if (arguments.length > 0) {\n      index = conversions.long(index, {\n        context: \"Failed to execute 'remove' on 'HTMLSelectElement': parameter 1\"\n      });\n      this.options.remove(index);\n    } else {\n      super.remove();\n    }\n  }\n\n  _barredFromConstraintValidationSpecialization() {\n    return this.hasAttribute(\"readonly\");\n  }\n\n  // Constraint validation: If the element has its required attribute specified,\n  // and either none of the option elements in the select element's list of options\n  // have their selectedness set to true, or the only option element in the select\n  // element's list of options with its selectedness set to true is the placeholder\n  // label option, then the element is suffering from being missing.\n  get validity() {\n    if (!this._validity) {\n      this._validity = ValidityState.createImpl(this, {\n        valueMissing: () => {\n          if (!this.hasAttribute(\"required\")) {\n            return false;\n          }\n          const selectedOptionIndex = this.selectedIndex;\n          return selectedOptionIndex < 0 || (selectedOptionIndex === 0 && this._hasPlaceholderOption);\n        }\n      });\n    }\n    return this._validity;\n  }\n\n  // If a select element has a required attribute specified, does not have a multiple attribute\n  // specified, and has a display size of 1; and if the value of the first option element in the\n  // select element's list of options (if any) is the empty string, and that option element's parent\n  // node is the select element(and not an optgroup element), then that option is the select\n  // element's placeholder label option.\n  // https://html.spec.whatwg.org/multipage/form-elements.html#placeholder-label-option\n  get _hasPlaceholderOption() {\n    return this.hasAttribute(\"required\") && !this.hasAttribute(\"multiple\") &&\n      this._displaySize === 1 && this.options.length > 0 && this.options.item(0).value === \"\" &&\n      this.options.item(0).parentNode._localName !== \"optgroup\";\n  }\n}\n\nmixin(HTMLSelectElementImpl.prototype, DefaultConstraintValidationImpl.prototype);\n\nmodule.exports = {\n  implementation: HTMLSelectElementImpl\n};\n"]},"metadata":{},"sourceType":"script"}