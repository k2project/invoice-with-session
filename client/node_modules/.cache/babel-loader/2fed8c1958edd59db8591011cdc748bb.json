{"ast":null,"code":"var _jsxFileName = \"/Users/krispol/Desktop/invoice/invoice-with-session/client/src/pages/login/Login.js\";\nimport axios from 'axios';\nimport React, { useState, Fragment } from 'react';\nimport PropTypes from 'prop-types';\nimport { Link, Redirect } from 'react-router-dom';\nimport { connect } from 'react-redux';\nimport { setAlert } from '../../redux/actions/alerts';\nimport { loadUser, handle401Err } from '../../redux/actions/user';\nimport Logo from '../../components/logo/Logo';\nimport FormErrorsDisplay from '../../components/forms/FormErrorsDisplay';\nimport { inputOnChange, updateStateErrors } from '../../components/forms/formFuns';\nimport setAuthToken from '../../utils/setAuthToken';\nimport './Login.scss';\n\nconst Login = ({\n  isAuthenticated,\n  redirectLink,\n  setAlert,\n  loadUser,\n  handle401Err\n}) => {\n  const [formData, setFormData] = useState({\n    email: '',\n    password: '',\n    errors: []\n  });\n\n  const onChange = e => {\n    inputOnChange(e, formData, setFormData);\n  };\n\n  const onSubmit = async e => {\n    e.preventDefault();\n    const form = e.target;\n\n    try {\n      const config = {\n        headers: {\n          'Content-Type': 'application/json'\n        }\n      };\n      const body = JSON.stringify(formData);\n      const res = await axios.post('/api/user/login', body, config); //set the token for auth and load user\n\n      sessionStorage.setItem('token', res.data.token);\n      setAuthToken(res.data.token);\n      loadUser();\n      setAlert('Login successful.', 'success', \"your profile's dashboard\");\n    } catch (err) {\n      sessionStorage.removeItem('token');\n      console.log('LOGIN FORM ERR:', err);\n      if (err.response) updateStateErrors(form, formData, setFormData, err.response.data.errors);\n\n      if (err.response.status === 401) {\n        handle401Err();\n      }\n    }\n  };\n\n  return /*#__PURE__*/React.createElement(Fragment, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 73,\n      columnNumber: 9\n    }\n  }, isAuthenticated && /*#__PURE__*/React.createElement(Redirect, {\n    to: sessionStorage.link ? sessionStorage.link : redirectLink,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 75,\n      columnNumber: 17\n    }\n  }), !isAuthenticated && !sessionStorage.token && /*#__PURE__*/React.createElement(\"main\", {\n    className: \"login\",\n    id: \"main\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 82,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"section\", {\n    className: \"login__bg\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 83,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"cover cover--theme\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 84,\n      columnNumber: 25\n    }\n  }, /*#__PURE__*/React.createElement(Logo, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 85,\n      columnNumber: 29\n    }\n  }))), /*#__PURE__*/React.createElement(\"section\", {\n    className: \"login__form\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 88,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(\"h1\", {\n    className: \"heading heading--md\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 89,\n      columnNumber: 25\n    }\n  }, \"Login\"), /*#__PURE__*/React.createElement(\"form\", {\n    onSubmit: onSubmit,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 91,\n      columnNumber: 25\n    }\n  }, /*#__PURE__*/React.createElement(\"label\", {\n    htmlFor: \"email\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 92,\n      columnNumber: 29\n    }\n  }, \"Email\"), /*#__PURE__*/React.createElement(\"input\", {\n    type: \"text\",\n    id: \"email\",\n    name: \"email\",\n    onChange: onChange,\n    className: \"form__input\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 93,\n      columnNumber: 29\n    }\n  }), /*#__PURE__*/React.createElement(\"label\", {\n    htmlFor: \"password\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 29\n    }\n  }, \"Password\"), /*#__PURE__*/React.createElement(\"input\", {\n    type: \"password\",\n    id: \"password\",\n    name: \"password\",\n    onChange: onChange,\n    className: \"form__input\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 101,\n      columnNumber: 29\n    }\n  }), formData.errors.length > 0 && /*#__PURE__*/React.createElement(FormErrorsDisplay, {\n    errors: formData.errors,\n    label: \"login\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 110,\n      columnNumber: 33\n    }\n  }), /*#__PURE__*/React.createElement(\"button\", {\n    type: \"submit\",\n    className: \"btn btn--form btn--theme\",\n    onMouseDown: e => e.preventDefault(),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 116,\n      columnNumber: 29\n    }\n  }, \"Sign In\")), /*#__PURE__*/React.createElement(\"p\", {\n    className: \"p--sml\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 124,\n      columnNumber: 25\n    }\n  }, \"Need an account?\", ' ', /*#__PURE__*/React.createElement(Link, {\n    to: \"/register\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 126,\n      columnNumber: 29\n    }\n  }, \"Sign up now.\")))));\n};\n\nLogin.propTypes = {\n  setAlert: PropTypes.func.isRequired,\n  loadUser: PropTypes.func.isRequired,\n  isAuthenticated: PropTypes.bool.isRequired\n};\n\nconst mapStateToProps = state => ({\n  isAuthenticated: state.user.isAuthenticated,\n  redirectLink: state.global.redirectLink\n});\n\nexport default connect(mapStateToProps, {\n  setAlert,\n  loadUser,\n  handle401Err\n})(Login);","map":{"version":3,"sources":["/Users/krispol/Desktop/invoice/invoice-with-session/client/src/pages/login/Login.js"],"names":["axios","React","useState","Fragment","PropTypes","Link","Redirect","connect","setAlert","loadUser","handle401Err","Logo","FormErrorsDisplay","inputOnChange","updateStateErrors","setAuthToken","Login","isAuthenticated","redirectLink","formData","setFormData","email","password","errors","onChange","e","onSubmit","preventDefault","form","target","config","headers","body","JSON","stringify","res","post","sessionStorage","setItem","data","token","err","removeItem","console","log","response","status","link","length","propTypes","func","isRequired","bool","mapStateToProps","state","user","global"],"mappings":"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","sourcesContent":["import axios from 'axios';\nimport React, { useState, Fragment } from 'react';\nimport PropTypes from 'prop-types';\nimport { Link, Redirect } from 'react-router-dom';\nimport { connect } from 'react-redux';\nimport { setAlert } from '../../redux/actions/alerts';\nimport { loadUser, handle401Err } from '../../redux/actions/user';\nimport Logo from '../../components/logo/Logo';\nimport FormErrorsDisplay from '../../components/forms/FormErrorsDisplay';\nimport {\n    inputOnChange,\n    updateStateErrors,\n} from '../../components/forms/formFuns';\nimport setAuthToken from '../../utils/setAuthToken';\n\nimport './Login.scss';\n\nconst Login = ({\n    isAuthenticated,\n    redirectLink,\n    setAlert,\n    loadUser,\n    handle401Err,\n}) => {\n    const [formData, setFormData] = useState({\n        email: '',\n        password: '',\n        errors: [],\n    });\n\n    const onChange = (e) => {\n        inputOnChange(e, formData, setFormData);\n    };\n\n    const onSubmit = async (e) => {\n        e.preventDefault();\n        const form = e.target;\n        try {\n            const config = {\n                headers: {\n                    'Content-Type': 'application/json',\n                },\n            };\n\n            const body = JSON.stringify(formData);\n            const res = await axios.post('/api/user/login', body, config);\n            //set the token for auth and load user\n            sessionStorage.setItem('token', res.data.token);\n            setAuthToken(res.data.token);\n            loadUser();\n            setAlert(\n                'Login successful.',\n                'success',\n                \"your profile's dashboard\"\n            );\n        } catch (err) {\n            sessionStorage.removeItem('token');\n            console.log('LOGIN FORM ERR:', err);\n            if (err.response)\n                updateStateErrors(\n                    form,\n                    formData,\n                    setFormData,\n                    err.response.data.errors\n                );\n            if (err.response.status === 401) {\n                handle401Err();\n            }\n        }\n    };\n\n    return (\n        <Fragment>\n            {isAuthenticated && (\n                <Redirect\n                    to={\n                        sessionStorage.link ? sessionStorage.link : redirectLink\n                    }\n                />\n            )}\n            {!isAuthenticated && !sessionStorage.token && (\n                <main className='login' id='main'>\n                    <section className='login__bg'>\n                        <div className='cover cover--theme'>\n                            <Logo />\n                        </div>\n                    </section>\n                    <section className='login__form'>\n                        <h1 className='heading heading--md'>Login</h1>\n\n                        <form onSubmit={onSubmit}>\n                            <label htmlFor='email'>Email</label>\n                            <input\n                                type='text'\n                                id='email'\n                                name='email'\n                                onChange={onChange}\n                                className='form__input'\n                            />\n                            <label htmlFor='password'>Password</label>\n                            <input\n                                type='password'\n                                id='password'\n                                name='password'\n                                onChange={onChange}\n                                className='form__input'\n                            />\n\n                            {formData.errors.length > 0 && (\n                                <FormErrorsDisplay\n                                    errors={formData.errors}\n                                    label='login'\n                                />\n                            )}\n\n                            <button\n                                type='submit'\n                                className='btn btn--form btn--theme'\n                                onMouseDown={(e) => e.preventDefault()}\n                            >\n                                Sign In\n                            </button>\n                        </form>\n                        <p className='p--sml'>\n                            Need an account?{' '}\n                            <Link to='/register'>Sign up now.</Link>\n                        </p>\n                    </section>\n                </main>\n            )}\n        </Fragment>\n    );\n};\n\nLogin.propTypes = {\n    setAlert: PropTypes.func.isRequired,\n    loadUser: PropTypes.func.isRequired,\n    isAuthenticated: PropTypes.bool.isRequired,\n};\nconst mapStateToProps = (state) => ({\n    isAuthenticated: state.user.isAuthenticated,\n    redirectLink: state.global.redirectLink,\n});\nexport default connect(mapStateToProps, { setAlert, loadUser, handle401Err })(\n    Login\n);\n"]},"metadata":{},"sourceType":"module"}