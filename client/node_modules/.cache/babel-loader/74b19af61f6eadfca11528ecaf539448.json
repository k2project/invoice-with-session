{"ast":null,"code":"\"use strict\";\n\nconst {\n  CookieJar\n} = require(\"tough-cookie\");\n\nconst NodeImpl = require(\"./Node-impl\").implementation;\n\nconst NODE_TYPE = require(\"../node-type\");\n\nconst {\n  mixin,\n  memoizeQuery\n} = require(\"../../utils\");\n\nconst {\n  firstChildWithHTMLLocalName,\n  firstChildWithHTMLLocalNames,\n  firstDescendantWithHTMLLocalName\n} = require(\"../helpers/traversal\");\n\nconst whatwgURL = require(\"whatwg-url\");\n\nconst {\n  StyleSheetList\n} = require(\"../../level2/style\");\n\nconst {\n  domSymbolTree\n} = require(\"../helpers/internal-constants\");\n\nconst eventAccessors = require(\"../helpers/create-event-accessor\");\n\nconst {\n  asciiLowercase,\n  stripAndCollapseASCIIWhitespace\n} = require(\"../helpers/strings\");\n\nconst {\n  HTML_NS,\n  SVG_NS\n} = require(\"../helpers/namespaces\");\n\nconst DOMException = require(\"domexception\");\n\nconst HTMLToDOM = require(\"../../browser/htmltodom\");\n\nconst History = require(\"../generated/History\");\n\nconst Location = require(\"../generated/Location\");\n\nconst HTMLCollection = require(\"../generated/HTMLCollection\");\n\nconst NodeList = require(\"../generated/NodeList\");\n\nconst validateName = require(\"../helpers/validate-names\").name;\n\nconst {\n  validateAndExtract\n} = require(\"../helpers/validate-names\");\n\nconst resourceLoader = require(\"../../browser/resource-loader\");\n\nconst GlobalEventHandlersImpl = require(\"./GlobalEventHandlers-impl\").implementation;\n\nconst {\n  clone,\n  listOfElementsWithQualifiedName,\n  listOfElementsWithNamespaceAndLocalName,\n  listOfElementsWithClassNames\n} = require(\"../node\");\n\nconst generatedAttr = require(\"../generated/Attr\");\n\nconst Comment = require(\"../generated/Comment\");\n\nconst ProcessingInstruction = require(\"../generated/ProcessingInstruction\");\n\nconst CDATASection = require(\"../generated/CDATASection\");\n\nconst Text = require(\"../generated/Text\");\n\nconst DocumentFragment = require(\"../generated/DocumentFragment\");\n\nconst DOMImplementation = require(\"../generated/DOMImplementation\");\n\nconst NonElementParentNodeImpl = require(\"./NonElementParentNode-impl\").implementation;\n\nconst ParentNodeImpl = require(\"./ParentNode-impl\").implementation;\n\nconst Element = require(\"../generated/Element\");\n\nconst HTMLUnknownElement = require(\"../generated/HTMLUnknownElement\");\n\nconst SVGElement = require(\"../generated/SVGElement\");\n\nconst TreeWalker = require(\"../generated/TreeWalker\");\n\nconst NodeIterator = require(\"../generated/NodeIterator\");\n\nconst CustomEvent = require(\"../generated/CustomEvent\");\n\nconst ErrorEvent = require(\"../generated/ErrorEvent\");\n\nconst Event = require(\"../generated/Event\");\n\nconst FocusEvent = require(\"../generated/FocusEvent\");\n\nconst HashChangeEvent = require(\"../generated/HashChangeEvent\");\n\nconst KeyboardEvent = require(\"../generated/KeyboardEvent\");\n\nconst MessageEvent = require(\"../generated/MessageEvent\");\n\nconst MouseEvent = require(\"../generated/MouseEvent\");\n\nconst PopStateEvent = require(\"../generated/PopStateEvent\");\n\nconst ProgressEvent = require(\"../generated/ProgressEvent\");\n\nconst TouchEvent = require(\"../generated/TouchEvent\");\n\nconst UIEvent = require(\"../generated/UIEvent\");\n\nfunction clearChildNodes(node) {\n  for (let child = domSymbolTree.firstChild(node); child; child = domSymbolTree.firstChild(node)) {\n    node.removeChild(child);\n  }\n}\n\nclass ResourceQueue {\n  constructor(paused) {\n    this.paused = Boolean(paused);\n  }\n\n  push(callback) {\n    const q = this;\n    const item = {\n      prev: q.tail,\n\n      check() {\n        if (!q.paused && !this.prev && this.fired) {\n          callback(this.err, this.data, this.response);\n\n          if (this.next) {\n            this.next.prev = null;\n            this.next.check();\n          } else {\n            // q.tail===this\n            q.tail = null;\n          }\n        }\n      }\n\n    };\n\n    if (q.tail) {\n      q.tail.next = item;\n    }\n\n    q.tail = item;\n    return (err, data, response) => {\n      item.fired = 1;\n      item.err = err;\n      item.data = data;\n      item.response = response;\n      item.check();\n    };\n  }\n\n  resume() {\n    if (!this.paused) {\n      return;\n    }\n\n    this.paused = false;\n    let head = this.tail;\n\n    while (head && head.prev) {\n      head = head.prev;\n    }\n\n    if (head) {\n      head.check();\n    }\n  }\n\n}\n\nclass RequestManager {\n  constructor() {\n    this.openedRequests = [];\n  }\n\n  add(req) {\n    this.openedRequests.push(req);\n  }\n\n  remove(req) {\n    const idx = this.openedRequests.indexOf(req);\n\n    if (idx !== -1) {\n      this.openedRequests.splice(idx, 1);\n    }\n  }\n\n  close() {\n    for (const openedRequest of this.openedRequests) {\n      openedRequest.abort();\n    }\n\n    this.openedRequests = [];\n  }\n\n  size() {\n    return this.openedRequests.length;\n  }\n\n}\n\nfunction pad(number) {\n  if (number < 10) {\n    return \"0\" + number;\n  }\n\n  return number;\n}\n\nfunction toLastModifiedString(date) {\n  return pad(date.getMonth() + 1) + \"/\" + pad(date.getDate()) + \"/\" + date.getFullYear() + \" \" + pad(date.getHours()) + \":\" + pad(date.getMinutes()) + \":\" + pad(date.getSeconds());\n}\n\nconst eventInterfaceTable = {\n  customevent: CustomEvent,\n  errorevent: ErrorEvent,\n  event: Event,\n  events: Event,\n  focusevent: FocusEvent,\n  hashchangeevent: HashChangeEvent,\n  htmlevents: Event,\n  keyboardevent: KeyboardEvent,\n  messageevent: MessageEvent,\n  mouseevent: MouseEvent,\n  mouseevents: MouseEvent,\n  popstateevent: PopStateEvent,\n  progressevent: ProgressEvent,\n  svgevents: Event,\n  touchevent: TouchEvent,\n  uievent: UIEvent,\n  uievents: UIEvent\n};\n\nclass DocumentImpl extends NodeImpl {\n  constructor(args, privateData) {\n    super(args, privateData);\n\n    this._initGlobalEvents();\n\n    this._ownerDocument = this;\n    this.nodeType = NODE_TYPE.DOCUMENT_NODE;\n\n    if (!privateData.options) {\n      privateData.options = {};\n    }\n\n    if (!privateData.options.parsingMode) {\n      privateData.options.parsingMode = \"xml\";\n    }\n\n    if (!privateData.options.encoding) {\n      privateData.options.encoding = \"UTF-8\";\n    }\n\n    if (!privateData.options.contentType) {\n      privateData.options.contentType = privateData.options.parsingMode === \"xml\" ? \"application/xml\" : \"text/html\";\n    }\n\n    this._parsingMode = privateData.options.parsingMode;\n    this._htmlToDom = new HTMLToDOM(privateData.options.parsingMode);\n    this._implementation = DOMImplementation.createImpl([], {\n      ownerDocument: this\n    });\n    this._defaultView = privateData.options.defaultView || null;\n    this._global = privateData.options.global;\n    this._documentElement = null;\n    this._ids = Object.create(null);\n    this._attached = true;\n    this._currentScript = null;\n    this._cookieJar = privateData.options.cookieJar;\n    this._parseOptions = privateData.options.parseOptions;\n\n    if (this._cookieJar === undefined) {\n      this._cookieJar = new CookieJar(null, {\n        looseMode: true\n      });\n    }\n\n    this.contentType = privateData.options.contentType;\n    this._encoding = privateData.options.encoding;\n    const urlOption = privateData.options.url === undefined ? \"about:blank\" : privateData.options.url;\n    const parsed = whatwgURL.parseURL(urlOption);\n\n    if (parsed === null) {\n      throw new TypeError(`Could not parse \"${urlOption}\" as a URL`);\n    }\n\n    this._URL = parsed;\n    this.origin = whatwgURL.serializeURLOrigin(parsed);\n    this._location = Location.createImpl([], {\n      relevantDocument: this\n    });\n    this._history = History.createImpl([], {\n      window: this._defaultView,\n      document: this,\n      actAsIfLocationReloadCalled: () => this._location.reload()\n    });\n\n    if (privateData.options.cookie) {\n      const cookies = Array.isArray(privateData.options.cookie) ? privateData.options.cookie : [privateData.options.cookie];\n      const document = this;\n      cookies.forEach(cookieStr => {\n        document._cookieJar.setCookieSync(cookieStr, document.URL, {\n          ignoreError: true\n        });\n      });\n    }\n\n    this._workingNodeIterators = [];\n    this._workingNodeIteratorsMax = privateData.options.concurrentNodeIterators === undefined ? 10 : Number(privateData.options.concurrentNodeIterators);\n\n    if (isNaN(this._workingNodeIteratorsMax)) {\n      throw new TypeError(\"The 'concurrentNodeIterators' option must be a Number\");\n    }\n\n    if (this._workingNodeIteratorsMax < 0) {\n      throw new RangeError(\"The 'concurrentNodeIterators' option must be a non negative Number\");\n    }\n\n    this._referrer = privateData.options.referrer || \"\";\n    this._lastModified = toLastModifiedString(privateData.options.lastModified || new Date());\n    this._queue = new ResourceQueue(privateData.options.deferClose);\n    this._customResourceLoader = privateData.options.resourceLoader;\n    this._pool = privateData.options.pool;\n    this._agentOptions = privateData.options.agentOptions;\n    this._strictSSL = privateData.options.strictSSL;\n    this._proxy = privateData.options.proxy;\n    this._requestManager = new RequestManager();\n    this.readyState = \"loading\";\n    this._lastFocusedElement = null; // Each Document in a browsing context can also have a latest entry. This is the entry for that Document\n    // to which the browsing context's session history was most recently traversed. When a Document is created,\n    // it initially has no latest entry.\n\n    this._latestEntry = null;\n  }\n\n  get compatMode() {\n    return this._parsingMode === \"xml\" || this.doctype ? \"CSS1Compat\" : \"BackCompat\";\n  }\n\n  get charset() {\n    return this._encoding;\n  }\n\n  get characterSet() {\n    return this._encoding;\n  }\n\n  get inputEncoding() {\n    return this._encoding;\n  }\n\n  get doctype() {\n    for (const childNode of domSymbolTree.childrenIterator(this)) {\n      if (childNode.nodeType === NODE_TYPE.DOCUMENT_TYPE_NODE) {\n        return childNode;\n      }\n    }\n\n    return null;\n  }\n\n  get URL() {\n    return whatwgURL.serializeURL(this._URL);\n  }\n\n  get documentURI() {\n    return whatwgURL.serializeURL(this._URL);\n  }\n\n  get location() {\n    return this._defaultView ? this._location : null;\n  }\n\n  get documentElement() {\n    if (this._documentElement) {\n      return this._documentElement;\n    }\n\n    for (const childNode of domSymbolTree.childrenIterator(this)) {\n      if (childNode.nodeType === NODE_TYPE.ELEMENT_NODE) {\n        this._documentElement = childNode;\n        return childNode;\n      }\n    }\n\n    return null;\n  }\n\n  get implementation() {\n    return this._implementation;\n  }\n\n  set implementation(implementation) {\n    this._implementation = implementation;\n  }\n\n  get defaultView() {\n    return this._defaultView;\n  }\n\n  get currentScript() {\n    return this._currentScript;\n  }\n\n  get activeElement() {\n    if (this._lastFocusedElement) {\n      return this._lastFocusedElement;\n    }\n\n    return this.body;\n  }\n\n  hasFocus() {\n    return Boolean(this._lastFocusedElement);\n  }\n\n  _createElementWithCorrectElementInterface(localName, namespace) {\n    // https://dom.spec.whatwg.org/#concept-element-interface\n    if (this._elementBuilders[namespace] && this._elementBuilders[namespace][localName]) {\n      return this._elementBuilders[namespace][localName](this, localName, namespace);\n    } else if (namespace === HTML_NS) {\n      return HTMLUnknownElement.createImpl([], {\n        ownerDocument: this,\n        localName,\n        namespace\n      });\n    } else if (namespace === SVG_NS) {\n      return SVGElement.createImpl([], {\n        ownerDocument: this,\n        localName,\n        namespace\n      });\n    }\n\n    return Element.createImpl([], {\n      ownerDocument: this,\n      localName,\n      namespace\n    });\n  }\n\n  appendChild(\n  /* Node */\n  arg) {\n    if (this.documentElement && arg.nodeType === NODE_TYPE.ELEMENT_NODE) {\n      throw new DOMException(\"The operation would yield an incorrect node tree.\", \"HierarchyRequestError\");\n    }\n\n    return super.appendChild(arg);\n  }\n\n  removeChild(\n  /* Node */\n  arg) {\n    const ret = super.removeChild(arg);\n\n    if (arg === this._documentElement) {\n      this._documentElement = null; // force a recalculation\n    }\n\n    return ret;\n  }\n\n  _descendantRemoved(parent, child) {\n    if (child.tagName === \"STYLE\") {\n      const index = this.styleSheets.indexOf(child.sheet);\n\n      if (index > -1) {\n        this.styleSheets.splice(index, 1);\n      }\n    }\n  }\n\n  write() {\n    let text = \"\";\n\n    for (let i = 0; i < arguments.length; ++i) {\n      text += String(arguments[i]);\n    }\n\n    if (this._parsingMode === \"xml\") {\n      throw new DOMException(\"Cannot use document.write on XML documents\", \"InvalidStateError\");\n    }\n\n    if (this._writeAfterElement) {\n      // If called from an script element directly (during the first tick),\n      // the new elements are inserted right after that element.\n      const tempDiv = this.createElement(\"div\");\n      tempDiv.innerHTML = text;\n      let child = tempDiv.firstChild;\n      let previous = this._writeAfterElement;\n      const parent = this._writeAfterElement.parentNode;\n\n      while (child) {\n        const node = child;\n        child = child.nextSibling;\n        node._isMovingDueToDocumentWrite = true; // hack for script execution\n\n        parent.insertBefore(node, previous.nextSibling);\n        node._isMovingDueToDocumentWrite = false;\n        previous = node;\n      }\n    } else if (this.readyState === \"loading\") {\n      // During page loading, document.write appends to the current element\n      // Find the last child that has been added to the document.\n      if (this.lastChild) {\n        let node = this;\n\n        while (node.lastChild && node.lastChild.nodeType === NODE_TYPE.ELEMENT_NODE) {\n          node = node.lastChild;\n        }\n\n        node.innerHTML = text;\n      } else {\n        clearChildNodes(this);\n\n        this._htmlToDom.appendToDocument(text, this);\n      }\n    } else if (text) {\n      clearChildNodes(this);\n\n      this._htmlToDom.appendToDocument(text, this);\n    }\n  }\n\n  writeln() {\n    this.write(...arguments, \"\\n\");\n  } // This is implemented separately for Document (which has a _ids cache) and DocumentFragment (which does not).\n\n\n  getElementById(id) {\n    // Return the first element with this ID.\n    return this._ids[id] && this._ids[id].length > 0 ? this._ids[id][0] : null;\n  }\n\n  get referrer() {\n    return this._referrer || \"\";\n  }\n\n  get lastModified() {\n    return this._lastModified;\n  }\n\n  get images() {\n    return this.getElementsByTagName(\"IMG\");\n  }\n\n  get embeds() {\n    return this.getElementsByTagName(\"EMBED\");\n  }\n\n  get plugins() {\n    return this.embeds;\n  }\n\n  get links() {\n    return HTMLCollection.createImpl([], {\n      element: this,\n      query: () => domSymbolTree.treeToArray(this, {\n        filter: node => (node._localName === \"a\" || node._localName === \"area\") && node.hasAttribute(\"href\") && node._namespaceURI === HTML_NS\n      })\n    });\n  }\n\n  get forms() {\n    return this.getElementsByTagName(\"FORM\");\n  }\n\n  get scripts() {\n    return this.getElementsByTagName(\"SCRIPT\");\n  }\n\n  get anchors() {\n    return HTMLCollection.createImpl([], {\n      element: this,\n      query: () => domSymbolTree.treeToArray(this, {\n        filter: node => node._localName === \"a\" && node.hasAttribute(\"name\") && node._namespaceURI === HTML_NS\n      })\n    });\n  } // The applets attribute must return an\n  // HTMLCollection rooted at the Document node,\n  // whose filter matches nothing.\n  // (It exists for historical reasons.)\n\n\n  get applets() {\n    return HTMLCollection.createImpl([], {\n      element: this,\n      query: () => []\n    });\n  }\n\n  open() {\n    let child = domSymbolTree.firstChild(this);\n\n    while (child) {\n      this.removeChild(child);\n      child = domSymbolTree.firstChild(this);\n    }\n\n    this._documentElement = null;\n\n    this._modified();\n\n    return this;\n  }\n\n  close() {\n    this._queue.resume(); // Set the readyState to 'complete' once all resources are loaded.\n    // As a side-effect the document's load-event will be dispatched.\n\n\n    resourceLoader.enqueue(this, null, function () {\n      this.readyState = \"complete\";\n      const ev = this.createEvent(\"HTMLEvents\");\n      ev.initEvent(\"DOMContentLoaded\", false, false);\n      this.dispatchEvent(ev);\n    })(null, true);\n  }\n\n  getElementsByName(elementName) {\n    return NodeList.createImpl([], {\n      element: this,\n      query: () => domSymbolTree.treeToArray(this, {\n        filter: node => node.getAttribute && node.getAttribute(\"name\") === elementName\n      })\n    });\n  }\n\n  get title() {\n    // TODO SVG\n    const titleElement = firstDescendantWithHTMLLocalName(this, \"title\");\n    let value = titleElement !== null ? titleElement.textContent : \"\";\n    value = stripAndCollapseASCIIWhitespace(value);\n    return value;\n  }\n\n  set title(val) {\n    // TODO SVG\n    const titleElement = firstDescendantWithHTMLLocalName(this, \"title\");\n    const headElement = this.head;\n\n    if (titleElement === null && headElement === null) {\n      return;\n    }\n\n    let element;\n\n    if (titleElement !== null) {\n      element = titleElement;\n    } else {\n      element = this.createElement(\"title\");\n      headElement.appendChild(element);\n    }\n\n    element.textContent = val;\n  }\n\n  get dir() {\n    return this.documentElement ? this.documentElement.dir : \"\";\n  }\n\n  set dir(value) {\n    if (this.documentElement) {\n      this.documentElement.dir = value;\n    }\n  }\n\n  get head() {\n    return this.documentElement ? firstChildWithHTMLLocalName(this.documentElement, \"head\") : null;\n  }\n\n  get body() {\n    const {\n      documentElement\n    } = this;\n\n    if (!documentElement || documentElement._localName !== \"html\" || documentElement._namespaceURI !== HTML_NS) {\n      return null;\n    }\n\n    return firstChildWithHTMLLocalNames(this.documentElement, new Set([\"body\", \"frameset\"]));\n  }\n\n  set body(value) {\n    if (value === null || value._namespaceURI !== HTML_NS || value._localName !== \"body\" && value._localName !== \"frameset\") {\n      throw new DOMException(\"Cannot set the body to null or a non-body/frameset element\", \"HierarchyRequestError\");\n    }\n\n    const bodyElement = this.body;\n\n    if (value === bodyElement) {\n      return;\n    }\n\n    if (bodyElement !== null) {\n      bodyElement.parentNode.replaceChild(value, bodyElement);\n      return;\n    }\n\n    const {\n      documentElement\n    } = this;\n\n    if (documentElement === null) {\n      throw new DOMException(\"Cannot set the body when there is no document element\", \"HierarchyRequestError\");\n    }\n\n    documentElement.appendChild(value);\n  }\n\n  _runPreRemovingSteps(oldNode) {\n    for (const activeNodeIterator of this._workingNodeIterators) {\n      activeNodeIterator._preRemovingSteps(oldNode);\n    }\n  }\n\n  createEvent(type) {\n    const typeLower = type.toLowerCase();\n    const eventWrapper = eventInterfaceTable[typeLower] || null;\n\n    if (!eventWrapper) {\n      throw new DOMException(\"The provided event type (\\\"\" + type + \"\\\") is invalid\", \"NotSupportedError\");\n    }\n\n    const impl = eventWrapper.createImpl([\"\"]);\n    impl._initializedFlag = false;\n    return impl;\n  }\n\n  createProcessingInstruction(target, data) {\n    validateName(target);\n\n    if (data.includes(\"?>\")) {\n      throw new DOMException(\"Processing instruction data cannot contain the string \\\"?>\\\"\", \"InvalidCharacterError\");\n    }\n\n    return ProcessingInstruction.createImpl([], {\n      ownerDocument: this,\n      target,\n      data\n    });\n  } // https://dom.spec.whatwg.org/#dom-document-createcdatasection\n\n\n  createCDATASection(data) {\n    if (this._parsingMode === \"html\") {\n      throw new DOMException(\"Cannot create CDATA sections in HTML documents\", \"NotSupportedError\");\n    }\n\n    if (data.includes(\"]]>\")) {\n      throw new DOMException(\"CDATA section data cannot contain the string \\\"]]>\\\"\", \"InvalidCharacterError\");\n    }\n\n    return CDATASection.createImpl([], {\n      ownerDocument: this,\n      data\n    });\n  }\n\n  createTextNode(data) {\n    return Text.createImpl([], {\n      ownerDocument: this,\n      data\n    });\n  }\n\n  createComment(data) {\n    return Comment.createImpl([], {\n      ownerDocument: this,\n      data\n    });\n  }\n\n  createElement(localName) {\n    validateName(localName);\n\n    if (this._parsingMode === \"html\") {\n      localName = asciiLowercase(localName);\n    }\n\n    const namespace = this._parsingMode === \"html\" || this.contentType === \"application/xhtml+xml\" ? HTML_NS : null;\n    return this._createElementWithCorrectElementInterface(localName, namespace);\n  }\n\n  createElementNS(namespace, qualifiedName) {\n    namespace = namespace !== null ? String(namespace) : namespace;\n    const extracted = validateAndExtract(namespace, qualifiedName);\n\n    const element = this._createElementWithCorrectElementInterface(extracted.localName, extracted.namespace);\n\n    element._prefix = extracted.prefix;\n    return element;\n  }\n\n  createDocumentFragment() {\n    return DocumentFragment.createImpl([], {\n      ownerDocument: this\n    });\n  }\n\n  createAttribute(localName) {\n    validateName(localName);\n\n    if (this._parsingMode === \"html\") {\n      localName = asciiLowercase(localName);\n    }\n\n    return generatedAttr.createImpl([], {\n      localName\n    });\n  }\n\n  createAttributeNS(namespace, name) {\n    if (namespace === undefined) {\n      namespace = null;\n    }\n\n    namespace = namespace !== null ? String(namespace) : namespace;\n    const extracted = validateAndExtract(namespace, name);\n    return generatedAttr.createImpl([], {\n      namespace: extracted.namespace,\n      namespacePrefix: extracted.prefix,\n      localName: extracted.localName\n    });\n  } // TODO: Add callback interface support to `webidl2js`\n\n\n  createTreeWalker(root, whatToShow, filter) {\n    return TreeWalker.createImpl([], {\n      root,\n      whatToShow,\n      filter\n    });\n  }\n\n  createNodeIterator(root, whatToShow, filter) {\n    const nodeIterator = NodeIterator.createImpl([], {\n      root,\n      whatToShow,\n      filter\n    });\n\n    this._workingNodeIterators.push(nodeIterator);\n\n    while (this._workingNodeIterators.length > this._workingNodeIteratorsMax) {\n      const toInactivate = this._workingNodeIterators.shift();\n\n      toInactivate._working = false;\n    }\n\n    return nodeIterator;\n  }\n\n  importNode(node, deep) {\n    if (node.nodeType === NODE_TYPE.DOCUMENT_NODE) {\n      throw new DOMException(\"Cannot import a document node\", \"NotSupportedError\");\n    }\n\n    return clone(node, this, deep);\n  }\n\n  adoptNode(node) {\n    if (node.nodeType === NODE_TYPE.DOCUMENT_NODE) {\n      throw new DOMException(\"Cannot adopt a document node\", \"NotSupportedError\");\n    } // TODO: Determine correct way to detect a shadow root\n    // See also https://github.com/w3c/webcomponents/issues/182\n\n\n    if (node.parentNode) {\n      node.parentNode.removeChild(node);\n    }\n\n    node._ownerDocument = this;\n\n    for (const descendant of domSymbolTree.treeIterator(node)) {\n      descendant._ownerDocument = this;\n    }\n\n    return node;\n  }\n\n  get cookie() {\n    return this._cookieJar.getCookieStringSync(this.URL, {\n      http: false\n    });\n  }\n\n  set cookie(cookieStr) {\n    cookieStr = String(cookieStr);\n\n    this._cookieJar.setCookieSync(cookieStr, this.URL, {\n      http: false,\n      ignoreError: true\n    });\n  } // The clear(), captureEvents(), and releaseEvents() methods must do nothing\n\n\n  clear() {}\n\n  captureEvents() {}\n\n  releaseEvents() {}\n\n  get styleSheets() {\n    if (!this._styleSheets) {\n      this._styleSheets = new StyleSheetList();\n    } // TODO: each style and link element should register its sheet on creation\n    // and remove it on removal.\n\n\n    return this._styleSheets;\n  }\n\n  get hidden() {\n    if (this._defaultView && this._defaultView._pretendToBeVisual) {\n      return false;\n    }\n\n    return true;\n  }\n\n  get visibilityState() {\n    if (this._defaultView && this._defaultView._pretendToBeVisual) {\n      return \"visible\";\n    }\n\n    return \"prerender\";\n  }\n\n}\n\neventAccessors.createEventAccessor(DocumentImpl.prototype, \"readystatechange\");\nmixin(DocumentImpl.prototype, GlobalEventHandlersImpl.prototype);\nmixin(DocumentImpl.prototype, NonElementParentNodeImpl.prototype);\nmixin(DocumentImpl.prototype, ParentNodeImpl.prototype);\nDocumentImpl.prototype._elementBuilders = Object.create(null);\nDocumentImpl.prototype.getElementsByTagName = memoizeQuery(function (qualifiedName) {\n  return listOfElementsWithQualifiedName(qualifiedName, this);\n});\nDocumentImpl.prototype.getElementsByTagNameNS = memoizeQuery(function (namespace, localName) {\n  return listOfElementsWithNamespaceAndLocalName(namespace, localName, this);\n});\nDocumentImpl.prototype.getElementsByClassName = memoizeQuery(function getElementsByClassName(classNames) {\n  return listOfElementsWithClassNames(classNames, this);\n});\nmodule.exports = {\n  implementation: DocumentImpl\n};","map":{"version":3,"sources":["/Users/krispol/Desktop/invoice/invoice-with-session/client/node_modules/jsdom/lib/jsdom/living/nodes/Document-impl.js"],"names":["CookieJar","require","NodeImpl","implementation","NODE_TYPE","mixin","memoizeQuery","firstChildWithHTMLLocalName","firstChildWithHTMLLocalNames","firstDescendantWithHTMLLocalName","whatwgURL","StyleSheetList","domSymbolTree","eventAccessors","asciiLowercase","stripAndCollapseASCIIWhitespace","HTML_NS","SVG_NS","DOMException","HTMLToDOM","History","Location","HTMLCollection","NodeList","validateName","name","validateAndExtract","resourceLoader","GlobalEventHandlersImpl","clone","listOfElementsWithQualifiedName","listOfElementsWithNamespaceAndLocalName","listOfElementsWithClassNames","generatedAttr","Comment","ProcessingInstruction","CDATASection","Text","DocumentFragment","DOMImplementation","NonElementParentNodeImpl","ParentNodeImpl","Element","HTMLUnknownElement","SVGElement","TreeWalker","NodeIterator","CustomEvent","ErrorEvent","Event","FocusEvent","HashChangeEvent","KeyboardEvent","MessageEvent","MouseEvent","PopStateEvent","ProgressEvent","TouchEvent","UIEvent","clearChildNodes","node","child","firstChild","removeChild","ResourceQueue","constructor","paused","Boolean","push","callback","q","item","prev","tail","check","fired","err","data","response","next","resume","head","RequestManager","openedRequests","add","req","remove","idx","indexOf","splice","close","openedRequest","abort","size","length","pad","number","toLastModifiedString","date","getMonth","getDate","getFullYear","getHours","getMinutes","getSeconds","eventInterfaceTable","customevent","errorevent","event","events","focusevent","hashchangeevent","htmlevents","keyboardevent","messageevent","mouseevent","mouseevents","popstateevent","progressevent","svgevents","touchevent","uievent","uievents","DocumentImpl","args","privateData","_initGlobalEvents","_ownerDocument","nodeType","DOCUMENT_NODE","options","parsingMode","encoding","contentType","_parsingMode","_htmlToDom","_implementation","createImpl","ownerDocument","_defaultView","defaultView","_global","global","_documentElement","_ids","Object","create","_attached","_currentScript","_cookieJar","cookieJar","_parseOptions","parseOptions","undefined","looseMode","_encoding","urlOption","url","parsed","parseURL","TypeError","_URL","origin","serializeURLOrigin","_location","relevantDocument","_history","window","document","actAsIfLocationReloadCalled","reload","cookie","cookies","Array","isArray","forEach","cookieStr","setCookieSync","URL","ignoreError","_workingNodeIterators","_workingNodeIteratorsMax","concurrentNodeIterators","Number","isNaN","RangeError","_referrer","referrer","_lastModified","lastModified","Date","_queue","deferClose","_customResourceLoader","_pool","pool","_agentOptions","agentOptions","_strictSSL","strictSSL","_proxy","proxy","_requestManager","readyState","_lastFocusedElement","_latestEntry","compatMode","doctype","charset","characterSet","inputEncoding","childNode","childrenIterator","DOCUMENT_TYPE_NODE","serializeURL","documentURI","location","documentElement","ELEMENT_NODE","currentScript","activeElement","body","hasFocus","_createElementWithCorrectElementInterface","localName","namespace","_elementBuilders","appendChild","arg","ret","_descendantRemoved","parent","tagName","index","styleSheets","sheet","write","text","i","arguments","String","_writeAfterElement","tempDiv","createElement","innerHTML","previous","parentNode","nextSibling","_isMovingDueToDocumentWrite","insertBefore","lastChild","appendToDocument","writeln","getElementById","id","images","getElementsByTagName","embeds","plugins","links","element","query","treeToArray","filter","_localName","hasAttribute","_namespaceURI","forms","scripts","anchors","applets","open","_modified","enqueue","ev","createEvent","initEvent","dispatchEvent","getElementsByName","elementName","getAttribute","title","titleElement","value","textContent","val","headElement","dir","Set","bodyElement","replaceChild","_runPreRemovingSteps","oldNode","activeNodeIterator","_preRemovingSteps","type","typeLower","toLowerCase","eventWrapper","impl","_initializedFlag","createProcessingInstruction","target","includes","createCDATASection","createTextNode","createComment","createElementNS","qualifiedName","extracted","_prefix","prefix","createDocumentFragment","createAttribute","createAttributeNS","namespacePrefix","createTreeWalker","root","whatToShow","createNodeIterator","nodeIterator","toInactivate","shift","_working","importNode","deep","adoptNode","descendant","treeIterator","getCookieStringSync","http","clear","captureEvents","releaseEvents","_styleSheets","hidden","_pretendToBeVisual","visibilityState","createEventAccessor","prototype","getElementsByTagNameNS","getElementsByClassName","classNames","module","exports"],"mappings":"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","sourcesContent":["\"use strict\";\n\nconst { CookieJar } = require(\"tough-cookie\");\n\nconst NodeImpl = require(\"./Node-impl\").implementation;\n\nconst NODE_TYPE = require(\"../node-type\");\nconst { mixin, memoizeQuery } = require(\"../../utils\");\nconst { firstChildWithHTMLLocalName, firstChildWithHTMLLocalNames, firstDescendantWithHTMLLocalName } =\n  require(\"../helpers/traversal\");\nconst whatwgURL = require(\"whatwg-url\");\nconst { StyleSheetList } = require(\"../../level2/style\");\nconst { domSymbolTree } = require(\"../helpers/internal-constants\");\nconst eventAccessors = require(\"../helpers/create-event-accessor\");\nconst { asciiLowercase, stripAndCollapseASCIIWhitespace } = require(\"../helpers/strings\");\nconst { HTML_NS, SVG_NS } = require(\"../helpers/namespaces\");\nconst DOMException = require(\"domexception\");\nconst HTMLToDOM = require(\"../../browser/htmltodom\");\nconst History = require(\"../generated/History\");\nconst Location = require(\"../generated/Location\");\nconst HTMLCollection = require(\"../generated/HTMLCollection\");\nconst NodeList = require(\"../generated/NodeList\");\nconst validateName = require(\"../helpers/validate-names\").name;\nconst { validateAndExtract } = require(\"../helpers/validate-names\");\nconst resourceLoader = require(\"../../browser/resource-loader\");\n\nconst GlobalEventHandlersImpl = require(\"./GlobalEventHandlers-impl\").implementation;\n\nconst { clone, listOfElementsWithQualifiedName, listOfElementsWithNamespaceAndLocalName,\n  listOfElementsWithClassNames } = require(\"../node\");\nconst generatedAttr = require(\"../generated/Attr\");\nconst Comment = require(\"../generated/Comment\");\nconst ProcessingInstruction = require(\"../generated/ProcessingInstruction\");\nconst CDATASection = require(\"../generated/CDATASection\");\nconst Text = require(\"../generated/Text\");\nconst DocumentFragment = require(\"../generated/DocumentFragment\");\nconst DOMImplementation = require(\"../generated/DOMImplementation\");\nconst NonElementParentNodeImpl = require(\"./NonElementParentNode-impl\").implementation;\nconst ParentNodeImpl = require(\"./ParentNode-impl\").implementation;\nconst Element = require(\"../generated/Element\");\nconst HTMLUnknownElement = require(\"../generated/HTMLUnknownElement\");\nconst SVGElement = require(\"../generated/SVGElement\");\nconst TreeWalker = require(\"../generated/TreeWalker\");\nconst NodeIterator = require(\"../generated/NodeIterator\");\n\nconst CustomEvent = require(\"../generated/CustomEvent\");\nconst ErrorEvent = require(\"../generated/ErrorEvent\");\nconst Event = require(\"../generated/Event\");\nconst FocusEvent = require(\"../generated/FocusEvent\");\nconst HashChangeEvent = require(\"../generated/HashChangeEvent\");\nconst KeyboardEvent = require(\"../generated/KeyboardEvent\");\nconst MessageEvent = require(\"../generated/MessageEvent\");\nconst MouseEvent = require(\"../generated/MouseEvent\");\nconst PopStateEvent = require(\"../generated/PopStateEvent\");\nconst ProgressEvent = require(\"../generated/ProgressEvent\");\nconst TouchEvent = require(\"../generated/TouchEvent\");\nconst UIEvent = require(\"../generated/UIEvent\");\n\nfunction clearChildNodes(node) {\n  for (let child = domSymbolTree.firstChild(node); child; child = domSymbolTree.firstChild(node)) {\n    node.removeChild(child);\n  }\n}\n\nclass ResourceQueue {\n  constructor(paused) {\n    this.paused = Boolean(paused);\n  }\n\n  push(callback) {\n    const q = this;\n    const item = {\n      prev: q.tail,\n      check() {\n        if (!q.paused && !this.prev && this.fired) {\n          callback(this.err, this.data, this.response);\n          if (this.next) {\n            this.next.prev = null;\n            this.next.check();\n          } else { // q.tail===this\n            q.tail = null;\n          }\n        }\n      }\n    };\n    if (q.tail) {\n      q.tail.next = item;\n    }\n    q.tail = item;\n    return (err, data, response) => {\n      item.fired = 1;\n      item.err = err;\n      item.data = data;\n      item.response = response;\n      item.check();\n    };\n  }\n\n  resume() {\n    if (!this.paused) {\n      return;\n    }\n    this.paused = false;\n\n    let head = this.tail;\n    while (head && head.prev) {\n      head = head.prev;\n    }\n    if (head) {\n      head.check();\n    }\n  }\n}\n\nclass RequestManager {\n  constructor() {\n    this.openedRequests = [];\n  }\n\n  add(req) {\n    this.openedRequests.push(req);\n  }\n\n  remove(req) {\n    const idx = this.openedRequests.indexOf(req);\n    if (idx !== -1) {\n      this.openedRequests.splice(idx, 1);\n    }\n  }\n\n  close() {\n    for (const openedRequest of this.openedRequests) {\n      openedRequest.abort();\n    }\n    this.openedRequests = [];\n  }\n\n  size() {\n    return this.openedRequests.length;\n  }\n}\n\nfunction pad(number) {\n  if (number < 10) {\n    return \"0\" + number;\n  }\n  return number;\n}\n\nfunction toLastModifiedString(date) {\n  return pad(date.getMonth() + 1) +\n    \"/\" + pad(date.getDate()) +\n    \"/\" + date.getFullYear() +\n    \" \" + pad(date.getHours()) +\n    \":\" + pad(date.getMinutes()) +\n    \":\" + pad(date.getSeconds());\n}\n\nconst eventInterfaceTable = {\n  customevent: CustomEvent,\n  errorevent: ErrorEvent,\n  event: Event,\n  events: Event,\n  focusevent: FocusEvent,\n  hashchangeevent: HashChangeEvent,\n  htmlevents: Event,\n  keyboardevent: KeyboardEvent,\n  messageevent: MessageEvent,\n  mouseevent: MouseEvent,\n  mouseevents: MouseEvent,\n  popstateevent: PopStateEvent,\n  progressevent: ProgressEvent,\n  svgevents: Event,\n  touchevent: TouchEvent,\n  uievent: UIEvent,\n  uievents: UIEvent\n};\n\nclass DocumentImpl extends NodeImpl {\n  constructor(args, privateData) {\n    super(args, privateData);\n\n    this._initGlobalEvents();\n\n    this._ownerDocument = this;\n    this.nodeType = NODE_TYPE.DOCUMENT_NODE;\n    if (!privateData.options) {\n      privateData.options = {};\n    }\n    if (!privateData.options.parsingMode) {\n      privateData.options.parsingMode = \"xml\";\n    }\n    if (!privateData.options.encoding) {\n      privateData.options.encoding = \"UTF-8\";\n    }\n    if (!privateData.options.contentType) {\n      privateData.options.contentType = privateData.options.parsingMode === \"xml\" ? \"application/xml\" : \"text/html\";\n    }\n\n    this._parsingMode = privateData.options.parsingMode;\n    this._htmlToDom = new HTMLToDOM(privateData.options.parsingMode);\n\n    this._implementation = DOMImplementation.createImpl([], {\n      ownerDocument: this\n    });\n\n    this._defaultView = privateData.options.defaultView || null;\n    this._global = privateData.options.global;\n    this._documentElement = null;\n    this._ids = Object.create(null);\n    this._attached = true;\n    this._currentScript = null;\n    this._cookieJar = privateData.options.cookieJar;\n    this._parseOptions = privateData.options.parseOptions;\n    if (this._cookieJar === undefined) {\n      this._cookieJar = new CookieJar(null, { looseMode: true });\n    }\n\n    this.contentType = privateData.options.contentType;\n    this._encoding = privateData.options.encoding;\n\n    const urlOption = privateData.options.url === undefined ? \"about:blank\" : privateData.options.url;\n    const parsed = whatwgURL.parseURL(urlOption);\n    if (parsed === null) {\n      throw new TypeError(`Could not parse \"${urlOption}\" as a URL`);\n    }\n\n    this._URL = parsed;\n    this.origin = whatwgURL.serializeURLOrigin(parsed);\n\n    this._location = Location.createImpl([], { relevantDocument: this });\n    this._history = History.createImpl([], {\n      window: this._defaultView,\n      document: this,\n      actAsIfLocationReloadCalled: () => this._location.reload()\n    });\n\n    if (privateData.options.cookie) {\n      const cookies = Array.isArray(privateData.options.cookie) ?\n                      privateData.options.cookie :\n                      [privateData.options.cookie];\n      const document = this;\n\n      cookies.forEach(cookieStr => {\n        document._cookieJar.setCookieSync(cookieStr, document.URL, { ignoreError: true });\n      });\n    }\n\n    this._workingNodeIterators = [];\n    this._workingNodeIteratorsMax = privateData.options.concurrentNodeIterators === undefined ?\n                                    10 :\n                                    Number(privateData.options.concurrentNodeIterators);\n\n    if (isNaN(this._workingNodeIteratorsMax)) {\n      throw new TypeError(\"The 'concurrentNodeIterators' option must be a Number\");\n    }\n\n    if (this._workingNodeIteratorsMax < 0) {\n      throw new RangeError(\"The 'concurrentNodeIterators' option must be a non negative Number\");\n    }\n\n    this._referrer = privateData.options.referrer || \"\";\n    this._lastModified = toLastModifiedString(privateData.options.lastModified || new Date());\n    this._queue = new ResourceQueue(privateData.options.deferClose);\n    this._customResourceLoader = privateData.options.resourceLoader;\n    this._pool = privateData.options.pool;\n    this._agentOptions = privateData.options.agentOptions;\n    this._strictSSL = privateData.options.strictSSL;\n    this._proxy = privateData.options.proxy;\n    this._requestManager = new RequestManager();\n    this.readyState = \"loading\";\n\n    this._lastFocusedElement = null;\n\n    // Each Document in a browsing context can also have a latest entry. This is the entry for that Document\n    // to which the browsing context's session history was most recently traversed. When a Document is created,\n    // it initially has no latest entry.\n    this._latestEntry = null;\n  }\n\n  get compatMode() {\n    return this._parsingMode === \"xml\" || this.doctype ? \"CSS1Compat\" : \"BackCompat\";\n  }\n  get charset() {\n    return this._encoding;\n  }\n  get characterSet() {\n    return this._encoding;\n  }\n  get inputEncoding() {\n    return this._encoding;\n  }\n  get doctype() {\n    for (const childNode of domSymbolTree.childrenIterator(this)) {\n      if (childNode.nodeType === NODE_TYPE.DOCUMENT_TYPE_NODE) {\n        return childNode;\n      }\n    }\n    return null;\n  }\n  get URL() {\n    return whatwgURL.serializeURL(this._URL);\n  }\n  get documentURI() {\n    return whatwgURL.serializeURL(this._URL);\n  }\n  get location() {\n    return this._defaultView ? this._location : null;\n  }\n  get documentElement() {\n    if (this._documentElement) {\n      return this._documentElement;\n    }\n\n    for (const childNode of domSymbolTree.childrenIterator(this)) {\n      if (childNode.nodeType === NODE_TYPE.ELEMENT_NODE) {\n        this._documentElement = childNode;\n        return childNode;\n      }\n    }\n\n    return null;\n  }\n\n  get implementation() {\n    return this._implementation;\n  }\n  set implementation(implementation) {\n    this._implementation = implementation;\n  }\n\n  get defaultView() {\n    return this._defaultView;\n  }\n\n  get currentScript() {\n    return this._currentScript;\n  }\n\n  get activeElement() {\n    if (this._lastFocusedElement) {\n      return this._lastFocusedElement;\n    }\n\n    return this.body;\n  }\n\n  hasFocus() {\n    return Boolean(this._lastFocusedElement);\n  }\n\n  _createElementWithCorrectElementInterface(localName, namespace) {\n    // https://dom.spec.whatwg.org/#concept-element-interface\n\n    if (this._elementBuilders[namespace] && this._elementBuilders[namespace][localName]) {\n      return this._elementBuilders[namespace][localName](this, localName, namespace);\n    } else if (namespace === HTML_NS) {\n      return HTMLUnknownElement.createImpl([], {\n        ownerDocument: this,\n        localName,\n        namespace\n      });\n    } else if (namespace === SVG_NS) {\n      return SVGElement.createImpl([], {\n        ownerDocument: this,\n        localName,\n        namespace\n      });\n    }\n\n    return Element.createImpl([], {\n      ownerDocument: this,\n      localName,\n      namespace\n    });\n  }\n\n  appendChild(/* Node */ arg) {\n    if (this.documentElement && arg.nodeType === NODE_TYPE.ELEMENT_NODE) {\n      throw new DOMException(\"The operation would yield an incorrect node tree.\", \"HierarchyRequestError\");\n    }\n    return super.appendChild(arg);\n  }\n\n  removeChild(/* Node */ arg) {\n    const ret = super.removeChild(arg);\n    if (arg === this._documentElement) {\n      this._documentElement = null;// force a recalculation\n    }\n    return ret;\n  }\n\n  _descendantRemoved(parent, child) {\n    if (child.tagName === \"STYLE\") {\n      const index = this.styleSheets.indexOf(child.sheet);\n      if (index > -1) {\n        this.styleSheets.splice(index, 1);\n      }\n    }\n  }\n\n  write() {\n    let text = \"\";\n    for (let i = 0; i < arguments.length; ++i) {\n      text += String(arguments[i]);\n    }\n\n    if (this._parsingMode === \"xml\") {\n      throw new DOMException(\"Cannot use document.write on XML documents\", \"InvalidStateError\");\n    }\n\n    if (this._writeAfterElement) {\n      // If called from an script element directly (during the first tick),\n      // the new elements are inserted right after that element.\n      const tempDiv = this.createElement(\"div\");\n      tempDiv.innerHTML = text;\n\n      let child = tempDiv.firstChild;\n      let previous = this._writeAfterElement;\n      const parent = this._writeAfterElement.parentNode;\n\n      while (child) {\n        const node = child;\n        child = child.nextSibling;\n\n        node._isMovingDueToDocumentWrite = true; // hack for script execution\n        parent.insertBefore(node, previous.nextSibling);\n        node._isMovingDueToDocumentWrite = false;\n\n        previous = node;\n      }\n    } else if (this.readyState === \"loading\") {\n      // During page loading, document.write appends to the current element\n      // Find the last child that has been added to the document.\n      if (this.lastChild) {\n        let node = this;\n        while (node.lastChild && node.lastChild.nodeType === NODE_TYPE.ELEMENT_NODE) {\n          node = node.lastChild;\n        }\n        node.innerHTML = text;\n      } else {\n        clearChildNodes(this);\n        this._htmlToDom.appendToDocument(text, this);\n      }\n    } else if (text) {\n      clearChildNodes(this);\n      this._htmlToDom.appendToDocument(text, this);\n    }\n  }\n\n  writeln() {\n    this.write(...arguments, \"\\n\");\n  }\n\n  // This is implemented separately for Document (which has a _ids cache) and DocumentFragment (which does not).\n  getElementById(id) {\n    // Return the first element with this ID.\n    return this._ids[id] && this._ids[id].length > 0 ? this._ids[id][0] : null;\n  }\n\n  get referrer() {\n    return this._referrer || \"\";\n  }\n  get lastModified() {\n    return this._lastModified;\n  }\n  get images() {\n    return this.getElementsByTagName(\"IMG\");\n  }\n  get embeds() {\n    return this.getElementsByTagName(\"EMBED\");\n  }\n  get plugins() {\n    return this.embeds;\n  }\n  get links() {\n    return HTMLCollection.createImpl([], {\n      element: this,\n      query: () => domSymbolTree.treeToArray(this, {\n        filter: node => (node._localName === \"a\" || node._localName === \"area\") &&\n                        node.hasAttribute(\"href\") &&\n                        node._namespaceURI === HTML_NS\n      })\n    });\n  }\n  get forms() {\n    return this.getElementsByTagName(\"FORM\");\n  }\n  get scripts() {\n    return this.getElementsByTagName(\"SCRIPT\");\n  }\n  get anchors() {\n    return HTMLCollection.createImpl([], {\n      element: this,\n      query: () => domSymbolTree.treeToArray(this, {\n        filter: node => node._localName === \"a\" &&\n                        node.hasAttribute(\"name\") &&\n                        node._namespaceURI === HTML_NS\n      })\n    });\n  }\n\n  // The applets attribute must return an\n  // HTMLCollection rooted at the Document node,\n  // whose filter matches nothing.\n  // (It exists for historical reasons.)\n  get applets() {\n    return HTMLCollection.createImpl([], {\n      element: this,\n      query: () => []\n    });\n  }\n\n  open() {\n    let child = domSymbolTree.firstChild(this);\n    while (child) {\n      this.removeChild(child);\n      child = domSymbolTree.firstChild(this);\n    }\n    this._documentElement = null;\n    this._modified();\n    return this;\n  }\n  close() {\n    this._queue.resume();\n\n    // Set the readyState to 'complete' once all resources are loaded.\n    // As a side-effect the document's load-event will be dispatched.\n    resourceLoader.enqueue(this, null, function () {\n      this.readyState = \"complete\";\n      const ev = this.createEvent(\"HTMLEvents\");\n      ev.initEvent(\"DOMContentLoaded\", false, false);\n      this.dispatchEvent(ev);\n    })(null, true);\n  }\n\n  getElementsByName(elementName) {\n    return NodeList.createImpl([], {\n      element: this,\n      query: () => domSymbolTree.treeToArray(this, {\n        filter: node => node.getAttribute && node.getAttribute(\"name\") === elementName\n      })\n    });\n  }\n\n  get title() {\n    // TODO SVG\n\n    const titleElement = firstDescendantWithHTMLLocalName(this, \"title\");\n    let value = titleElement !== null ? titleElement.textContent : \"\";\n    value = stripAndCollapseASCIIWhitespace(value);\n    return value;\n  }\n\n  set title(val) {\n    // TODO SVG\n\n    const titleElement = firstDescendantWithHTMLLocalName(this, \"title\");\n    const headElement = this.head;\n\n    if (titleElement === null && headElement === null) {\n      return;\n    }\n\n    let element;\n    if (titleElement !== null) {\n      element = titleElement;\n    } else {\n      element = this.createElement(\"title\");\n      headElement.appendChild(element);\n    }\n\n    element.textContent = val;\n  }\n\n  get dir() {\n    return this.documentElement ? this.documentElement.dir : \"\";\n  }\n  set dir(value) {\n    if (this.documentElement) {\n      this.documentElement.dir = value;\n    }\n  }\n\n  get head() {\n    return this.documentElement ? firstChildWithHTMLLocalName(this.documentElement, \"head\") : null;\n  }\n\n  get body() {\n    const { documentElement } = this;\n    if (!documentElement || documentElement._localName !== \"html\" ||\n        documentElement._namespaceURI !== HTML_NS) {\n      return null;\n    }\n\n    return firstChildWithHTMLLocalNames(this.documentElement, new Set([\"body\", \"frameset\"]));\n  }\n\n  set body(value) {\n    if (value === null ||\n        value._namespaceURI !== HTML_NS ||\n        (value._localName !== \"body\" && value._localName !== \"frameset\")) {\n      throw new DOMException(\"Cannot set the body to null or a non-body/frameset element\", \"HierarchyRequestError\");\n    }\n\n    const bodyElement = this.body;\n    if (value === bodyElement) {\n      return;\n    }\n\n    if (bodyElement !== null) {\n      bodyElement.parentNode.replaceChild(value, bodyElement);\n      return;\n    }\n\n    const { documentElement } = this;\n    if (documentElement === null) {\n      throw new DOMException(\"Cannot set the body when there is no document element\", \"HierarchyRequestError\");\n    }\n\n    documentElement.appendChild(value);\n  }\n\n  _runPreRemovingSteps(oldNode) {\n    for (const activeNodeIterator of this._workingNodeIterators) {\n      activeNodeIterator._preRemovingSteps(oldNode);\n    }\n  }\n\n  createEvent(type) {\n    const typeLower = type.toLowerCase();\n    const eventWrapper = eventInterfaceTable[typeLower] || null;\n\n    if (!eventWrapper) {\n      throw new DOMException(\"The provided event type (\\\"\" + type + \"\\\") is invalid\", \"NotSupportedError\");\n    }\n\n    const impl = eventWrapper.createImpl([\"\"]);\n    impl._initializedFlag = false;\n    return impl;\n  }\n\n  createProcessingInstruction(target, data) {\n    validateName(target);\n\n    if (data.includes(\"?>\")) {\n      throw new DOMException(\"Processing instruction data cannot contain the string \\\"?>\\\"\", \"InvalidCharacterError\");\n    }\n\n    return ProcessingInstruction.createImpl([], {\n      ownerDocument: this,\n      target,\n      data\n    });\n  }\n\n  // https://dom.spec.whatwg.org/#dom-document-createcdatasection\n  createCDATASection(data) {\n    if (this._parsingMode === \"html\") {\n      throw new DOMException(\"Cannot create CDATA sections in HTML documents\", \"NotSupportedError\");\n    }\n\n    if (data.includes(\"]]>\")) {\n      throw new DOMException(\"CDATA section data cannot contain the string \\\"]]>\\\"\", \"InvalidCharacterError\");\n    }\n\n    return CDATASection.createImpl([], {\n      ownerDocument: this,\n      data\n    });\n  }\n\n  createTextNode(data) {\n    return Text.createImpl([], {\n      ownerDocument: this,\n      data\n    });\n  }\n\n  createComment(data) {\n    return Comment.createImpl([], {\n      ownerDocument: this,\n      data\n    });\n  }\n\n  createElement(localName) {\n    validateName(localName);\n    if (this._parsingMode === \"html\") {\n      localName = asciiLowercase(localName);\n    }\n\n    const namespace = this._parsingMode === \"html\" || this.contentType === \"application/xhtml+xml\" ? HTML_NS : null;\n\n    return this._createElementWithCorrectElementInterface(localName, namespace);\n  }\n\n  createElementNS(namespace, qualifiedName) {\n    namespace = namespace !== null ? String(namespace) : namespace;\n\n    const extracted = validateAndExtract(namespace, qualifiedName);\n\n    const element = this._createElementWithCorrectElementInterface(extracted.localName, extracted.namespace);\n    element._prefix = extracted.prefix;\n\n    return element;\n  }\n\n  createDocumentFragment() {\n    return DocumentFragment.createImpl([], { ownerDocument: this });\n  }\n\n  createAttribute(localName) {\n    validateName(localName);\n\n    if (this._parsingMode === \"html\") {\n      localName = asciiLowercase(localName);\n    }\n\n    return generatedAttr.createImpl([], { localName });\n  }\n\n  createAttributeNS(namespace, name) {\n    if (namespace === undefined) {\n      namespace = null;\n    }\n    namespace = namespace !== null ? String(namespace) : namespace;\n\n    const extracted = validateAndExtract(namespace, name);\n    return generatedAttr.createImpl([], {\n      namespace: extracted.namespace,\n      namespacePrefix: extracted.prefix,\n      localName: extracted.localName\n    });\n  }\n\n  // TODO: Add callback interface support to `webidl2js`\n  createTreeWalker(root, whatToShow, filter) {\n    return TreeWalker.createImpl([], { root, whatToShow, filter });\n  }\n\n  createNodeIterator(root, whatToShow, filter) {\n    const nodeIterator = NodeIterator.createImpl([], { root, whatToShow, filter });\n\n    this._workingNodeIterators.push(nodeIterator);\n    while (this._workingNodeIterators.length > this._workingNodeIteratorsMax) {\n      const toInactivate = this._workingNodeIterators.shift();\n      toInactivate._working = false;\n    }\n\n    return nodeIterator;\n  }\n\n  importNode(node, deep) {\n    if (node.nodeType === NODE_TYPE.DOCUMENT_NODE) {\n      throw new DOMException(\"Cannot import a document node\", \"NotSupportedError\");\n    }\n\n    return clone(node, this, deep);\n  }\n\n  adoptNode(node) {\n    if (node.nodeType === NODE_TYPE.DOCUMENT_NODE) {\n      throw new DOMException(\"Cannot adopt a document node\", \"NotSupportedError\");\n    }\n    // TODO: Determine correct way to detect a shadow root\n    // See also https://github.com/w3c/webcomponents/issues/182\n\n    if (node.parentNode) {\n      node.parentNode.removeChild(node);\n    }\n    node._ownerDocument = this;\n    for (const descendant of domSymbolTree.treeIterator(node)) {\n      descendant._ownerDocument = this;\n    }\n\n    return node;\n  }\n\n  get cookie() {\n    return this._cookieJar.getCookieStringSync(this.URL, { http: false });\n  }\n  set cookie(cookieStr) {\n    cookieStr = String(cookieStr);\n    this._cookieJar.setCookieSync(cookieStr, this.URL, {\n      http: false,\n      ignoreError: true\n    });\n  }\n\n  // The clear(), captureEvents(), and releaseEvents() methods must do nothing\n  clear() {}\n\n  captureEvents() {}\n\n  releaseEvents() {}\n\n  get styleSheets() {\n    if (!this._styleSheets) {\n      this._styleSheets = new StyleSheetList();\n    }\n\n    // TODO: each style and link element should register its sheet on creation\n    // and remove it on removal.\n    return this._styleSheets;\n  }\n\n  get hidden() {\n    if (this._defaultView && this._defaultView._pretendToBeVisual) {\n      return false;\n    }\n\n    return true;\n  }\n\n  get visibilityState() {\n    if (this._defaultView && this._defaultView._pretendToBeVisual) {\n      return \"visible\";\n    }\n\n    return \"prerender\";\n  }\n}\n\neventAccessors.createEventAccessor(DocumentImpl.prototype, \"readystatechange\");\nmixin(DocumentImpl.prototype, GlobalEventHandlersImpl.prototype);\nmixin(DocumentImpl.prototype, NonElementParentNodeImpl.prototype);\nmixin(DocumentImpl.prototype, ParentNodeImpl.prototype);\n\nDocumentImpl.prototype._elementBuilders = Object.create(null);\n\nDocumentImpl.prototype.getElementsByTagName = memoizeQuery(function (qualifiedName) {\n  return listOfElementsWithQualifiedName(qualifiedName, this);\n});\n\nDocumentImpl.prototype.getElementsByTagNameNS = memoizeQuery(function (namespace, localName) {\n  return listOfElementsWithNamespaceAndLocalName(namespace, localName, this);\n});\n\nDocumentImpl.prototype.getElementsByClassName = memoizeQuery(function getElementsByClassName(classNames) {\n  return listOfElementsWithClassNames(classNames, this);\n});\n\nmodule.exports = {\n  implementation: DocumentImpl\n};\n"]},"metadata":{},"sourceType":"script"}