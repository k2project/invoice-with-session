{"ast":null,"code":"var _jsxFileName = \"/Users/krispol/Desktop/invoice/invoice-with-session/client/src/pages/company/companyInvoice/NewInvoice.js\";\nimport React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport { withRouter } from 'react-router-dom';\nimport { connect } from 'react-redux';\nimport { setInvoiceInitState } from '../../../redux/actions/invoice';\nimport InvoiceDoc from './invoiceDoc/InvoiceDoc';\nimport NewInvoiceSubmit from './NewInvoiceSubmit';\nimport { alertUnsavedChanges } from '../../../components/form/utils/handleUnsavedChanges';\nimport { getInputValueByLabel } from '../../../components/form/utils/customFormQueries';\nimport { date_YYYY_MM } from '../../../utils/dates';\n\nclass NewInvoice extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      invoice: null\n    };\n    this.handleChanges = this.handleChanges.bind(this);\n    this.clearInitState = this.clearInitState.bind(this);\n    this.updateInitStateToReduxStateOnSubmit = this.updateInitStateToReduxStateOnSubmit.bind(this);\n  }\n\n  handleChanges() {// alertUnsavedChanges(\n    //     this.state.invoice, //initial state\n    //     this.props.invoice, //redux updated state\n    //     `/dashboard/companies/${this.props.company._id}?tab=invoices`,\n    //     // this.props.setUpdates,\n    //     this.props.history\n    // );\n  }\n\n  updateInitStateToReduxStateOnSubmit() {// this.props.setUpdates(this.props.company.details);\n  }\n\n  clearInitState() {//on submit clear app updates\n    // this.props.setUpdates(null);\n  }\n\n  componentDidMount() {\n    let invoiceInitState;\n    const searchArr = window.location.search.split('&');\n\n    if (searchArr[1]) {\n      //updating an existing invoice\n      const invoiceID = searchArr[1].slice(8); //invoiceInitState from the invoices arr\n\n      invoiceInitState = {\n        _id: invoiceID\n      };\n    } else {\n      let company_abbr = getInputValueByLabel(this.props.company.details, 'Name').split(' ');\n\n      if (company_abbr.length > 1) {\n        company_abbr = company_abbr.map(el => el[0].toUpperCase()).join('');\n      } else {\n        company_abbr = company_abbr[0].slice(0, 3).toUpperCase();\n      }\n\n      let invoices_num = 0;\n      if (this.props.company.invoices) invoices_num = this.props.company.invoices.length + 1;\n      let saved_as = company_abbr + '-';\n      saved_as += date_YYYY_MM(new Date()) + '-'; // saved_as += this.props.company.invoices.length + 1;\n\n      console.log(saved_as); //a new invoice\n\n      invoiceInitState = {\n        saved_as,\n        bg_color: localStorage.invoice_bg || 'blue',\n        text_color: localStorage.invoice_txt || 'white',\n        profile: JSON.parse(JSON.stringify(this.props.profile.details)),\n        company: JSON.parse(JSON.stringify(this.props.company.details)),\n        tasks: JSON.parse(JSON.stringify(this.props.company.tasks))\n      };\n    } //set init state for comparison on component unmounting\n\n\n    this.setState({\n      invoice: JSON.parse(JSON.stringify(invoiceInitState))\n    }); //set redux state\n\n    this.props.setInvoiceInitState(invoiceInitState); // window.addEventListener('beforeunload', this.props.clearInitState);\n  }\n\n  componentWillUnmount() {\n    //auth err and logout won't trigger fun\n    if (this.props.authenticated) this.handleChanges(); // window.removeEventListener('beforeunload', this.props.clearInitState);\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(\"section\", {\n      className: \"company-invoice\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 95,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"h2\", {\n      className: \"sr-only\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 96,\n        columnNumber: 17\n      }\n    }, \"Create a new invoice.\"), this.state.invoice && /*#__PURE__*/React.createElement(InvoiceDoc, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 97,\n        columnNumber: 40\n      }\n    }), /*#__PURE__*/React.createElement(NewInvoiceSubmit, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 98,\n        columnNumber: 17\n      }\n    }));\n  }\n\n}\n\nNewInvoice.propTypes = {\n  authenticated: PropTypes.bool,\n  profile: PropTypes.object,\n  company: PropTypes.object,\n  invoice: PropTypes.object\n};\n\nconst mapStateToProps = state => ({\n  authenticated: state.session.authenticated,\n  profile: state.profile,\n  company: state.companies.find(c => c._id === state.session.currentCompany),\n  invoice: state.invoice\n});\n\nconst mapDispatchToProps = {\n  setInvoiceInitState\n};\nexport default connect(mapStateToProps, mapDispatchToProps)(withRouter(NewInvoice));","map":{"version":3,"sources":["/Users/krispol/Desktop/invoice/invoice-with-session/client/src/pages/company/companyInvoice/NewInvoice.js"],"names":["React","Component","PropTypes","withRouter","connect","setInvoiceInitState","InvoiceDoc","NewInvoiceSubmit","alertUnsavedChanges","getInputValueByLabel","date_YYYY_MM","NewInvoice","constructor","props","state","invoice","handleChanges","bind","clearInitState","updateInitStateToReduxStateOnSubmit","componentDidMount","invoiceInitState","searchArr","window","location","search","split","invoiceID","slice","_id","company_abbr","company","details","length","map","el","toUpperCase","join","invoices_num","invoices","saved_as","Date","console","log","bg_color","localStorage","invoice_bg","text_color","invoice_txt","profile","JSON","parse","stringify","tasks","setState","componentWillUnmount","authenticated","render","propTypes","bool","object","mapStateToProps","session","companies","find","c","currentCompany","mapDispatchToProps"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport { withRouter } from 'react-router-dom';\nimport { connect } from 'react-redux';\nimport { setInvoiceInitState } from '../../../redux/actions/invoice';\nimport InvoiceDoc from './invoiceDoc/InvoiceDoc';\nimport NewInvoiceSubmit from './NewInvoiceSubmit';\nimport { alertUnsavedChanges } from '../../../components/form/utils/handleUnsavedChanges';\nimport { getInputValueByLabel } from '../../../components/form/utils/customFormQueries';\nimport { date_YYYY_MM } from '../../../utils/dates';\n\nclass NewInvoice extends Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            invoice: null,\n        };\n        this.handleChanges = this.handleChanges.bind(this);\n        this.clearInitState = this.clearInitState.bind(this);\n        this.updateInitStateToReduxStateOnSubmit = this.updateInitStateToReduxStateOnSubmit.bind(\n            this\n        );\n    }\n    handleChanges() {\n        // alertUnsavedChanges(\n        //     this.state.invoice, //initial state\n        //     this.props.invoice, //redux updated state\n        //     `/dashboard/companies/${this.props.company._id}?tab=invoices`,\n        //     // this.props.setUpdates,\n        //     this.props.history\n        // );\n    }\n    updateInitStateToReduxStateOnSubmit() {\n        // this.props.setUpdates(this.props.company.details);\n    }\n    clearInitState() {\n        //on submit clear app updates\n        // this.props.setUpdates(null);\n    }\n    componentDidMount() {\n        let invoiceInitState;\n        const searchArr = window.location.search.split('&');\n        if (searchArr[1]) {\n            //updating an existing invoice\n            const invoiceID = searchArr[1].slice(8);\n            //invoiceInitState from the invoices arr\n            invoiceInitState = {\n                _id: invoiceID,\n            };\n        } else {\n            let company_abbr = getInputValueByLabel(\n                this.props.company.details,\n                'Name'\n            ).split(' ');\n            if (company_abbr.length > 1) {\n                company_abbr = company_abbr\n                    .map((el) => el[0].toUpperCase())\n                    .join('');\n            } else {\n                company_abbr = company_abbr[0].slice(0, 3).toUpperCase();\n            }\n            let invoices_num = 0;\n            if (this.props.company.invoices)\n                invoices_num = this.props.company.invoices.length + 1;\n            let saved_as = company_abbr + '-';\n            saved_as += date_YYYY_MM(new Date()) + '-';\n            // saved_as += this.props.company.invoices.length + 1;\n            console.log(saved_as);\n            //a new invoice\n            invoiceInitState = {\n                saved_as,\n                bg_color: localStorage.invoice_bg || 'blue',\n                text_color: localStorage.invoice_txt || 'white',\n                profile: JSON.parse(JSON.stringify(this.props.profile.details)),\n                company: JSON.parse(JSON.stringify(this.props.company.details)),\n                tasks: JSON.parse(JSON.stringify(this.props.company.tasks)),\n            };\n        }\n        //set init state for comparison on component unmounting\n        this.setState({\n            invoice: JSON.parse(JSON.stringify(invoiceInitState)),\n        });\n        //set redux state\n        this.props.setInvoiceInitState(invoiceInitState);\n\n        // window.addEventListener('beforeunload', this.props.clearInitState);\n    }\n    componentWillUnmount() {\n        //auth err and logout won't trigger fun\n        if (this.props.authenticated) this.handleChanges();\n        // window.removeEventListener('beforeunload', this.props.clearInitState);\n    }\n    render() {\n        return (\n            <section className='company-invoice'>\n                <h2 className='sr-only'>Create a new invoice.</h2>\n                {this.state.invoice && <InvoiceDoc />}\n                <NewInvoiceSubmit />\n            </section>\n        );\n    }\n}\n\nNewInvoice.propTypes = {\n    authenticated: PropTypes.bool,\n    profile: PropTypes.object,\n    company: PropTypes.object,\n    invoice: PropTypes.object,\n};\n\nconst mapStateToProps = (state) => ({\n    authenticated: state.session.authenticated,\n    profile: state.profile,\n    company: state.companies.find(\n        (c) => c._id === state.session.currentCompany\n    ),\n    invoice: state.invoice,\n});\n\nconst mapDispatchToProps = {\n    setInvoiceInitState,\n};\n\nexport default connect(\n    mapStateToProps,\n    mapDispatchToProps\n)(withRouter(NewInvoice));\n"]},"metadata":{},"sourceType":"module"}